/**
 * MIT License
 *
 * Copyright (c) 2018-2023 Ali Sait TEKE
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */

!function(){"use strict";var t="http://www.w3.org/1999/xhtml",e={svg:"http://www.w3.org/2000/svg",xhtml:t,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function n(t){var n=t+="",i=n.indexOf(":");return i>=0&&"xmlns"!==(n=t.slice(0,i))&&(t=t.slice(i+1)),e.hasOwnProperty(n)?{space:e[n],local:t}:t}function i(e){return function(){var n=this.ownerDocument,i=this.namespaceURI;return i===t&&n.documentElement.namespaceURI===t?n.createElement(e):n.createElementNS(i,e)}}function o(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function r(t){var e=n(t);return(e.local?o:i)(e)}function s(){}function a(t){return null==t?s:function(){return this.querySelector(t)}}function l(){return[]}function u(t){return null==t?l:function(){return this.querySelectorAll(t)}}function c(t){return function(){return this.matches(t)}}function h(t){return new Array(t.length)}function f(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}f.prototype={constructor:f,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function d(t,e,n,i,o,r){for(var s,a=0,l=e.length,u=r.length;a<u;++a)(s=e[a])?(s.__data__=r[a],i[a]=s):n[a]=new f(t,r[a]);for(;a<l;++a)(s=e[a])&&(o[a]=s)}function p(t,e,n,i,o,r,s){var a,l,u,c={},h=e.length,d=r.length,p=new Array(h);for(a=0;a<h;++a)(l=e[a])&&(p[a]=u="$"+s.call(l,l.__data__,a,e),u in c?o[a]=l:c[u]=l);for(a=0;a<d;++a)(l=c[u="$"+s.call(t,r[a],a,r)])?(i[a]=l,l.__data__=r[a],c[u]=null):n[a]=new f(t,r[a]);for(a=0;a<h;++a)(l=e[a])&&c[p[a]]===l&&(o[a]=l)}function g(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function m(t){return function(){this.removeAttribute(t)}}function v(t){return function(){this.removeAttributeNS(t.space,t.local)}}function y(t,e){return function(){this.setAttribute(t,e)}}function _(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function b(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function w(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function E(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function x(t){return function(){this.style.removeProperty(t)}}function k(t,e,n){return function(){this.style.setProperty(t,e,n)}}function M(t,e,n){return function(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function T(t,e){return t.style.getPropertyValue(e)||E(t).getComputedStyle(t,null).getPropertyValue(e)}function L(t){return function(){delete this[t]}}function z(t,e){return function(){this[t]=e}}function C(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function S(t){return t.trim().split(/^|\s+/)}function A(t){return t.classList||new O(t)}function O(t){this._node=t,this._names=S(t.getAttribute("class")||"")}function B(t,e){for(var n=A(t),i=-1,o=e.length;++i<o;)n.add(e[i])}function N(t,e){for(var n=A(t),i=-1,o=e.length;++i<o;)n.remove(e[i])}function U(t){return function(){B(this,t)}}function V(t){return function(){N(this,t)}}function G(t,e){return function(){(e.apply(this,arguments)?B:N)(this,t)}}function I(){this.textContent=""}function K(t){return function(){this.textContent=t}}function P(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function D(){this.innerHTML=""}function j(t){return function(){this.innerHTML=t}}function R(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function Z(){this.nextSibling&&this.parentNode.appendChild(this)}function H(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Y(){return null}function q(){var t=this.parentNode;t&&t.removeChild(this)}function X(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function W(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}O.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var F={},$=null;"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(F={mouseenter:"mouseover",mouseleave:"mouseout"}));function J(t,e,n){return t=Q(t,e,n),function(e){var n=e.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||t.call(this,e)}}function Q(t,e,n){return function(i){var o=$;$=i;try{t.call(this,this.__data__,e,n)}finally{$=o}}}function tt(t){return function(){var e=this.__on;if(e){for(var n,i=0,o=-1,r=e.length;i<r;++i)n=e[i],t.type&&n.type!==t.type||n.name!==t.name?e[++o]=n:this.removeEventListener(n.type,n.listener,n.capture);++o?e.length=o:delete this.__on}}}function et(t,e,n){var i=F.hasOwnProperty(t.type)?J:Q;return function(o,r,s){var a,l=this.__on,u=i(e,r,s);if(l)for(var c=0,h=l.length;c<h;++c)if((a=l[c]).type===t.type&&a.name===t.name)return this.removeEventListener(a.type,a.listener,a.capture),this.addEventListener(a.type,a.listener=u,a.capture=n),void(a.value=e);this.addEventListener(t.type,u,n),a={type:t.type,name:t.name,value:e,listener:u,capture:n},l?l.push(a):this.__on=[a]}}function nt(t,e,n){var i=E(t),o=i.CustomEvent;"function"==typeof o?o=new o(e,n):(o=i.document.createEvent("Event"),n?(o.initEvent(e,n.bubbles,n.cancelable),o.detail=n.detail):o.initEvent(e,!1,!1)),t.dispatchEvent(o)}function it(t,e){return function(){return nt(this,t,e)}}function ot(t,e){return function(){return nt(this,t,e.apply(this,arguments))}}var rt=[null];function st(t,e){this._groups=t,this._parents=e}function at(){return new st([[document.documentElement]],rt)}function lt(t){return"string"==typeof t?new st([[document.querySelector(t)]],[document.documentElement]):new st([[t]],rt)}function ut(){for(var t,e=$;t=e.sourceEvent;)e=t;return e}function ct(t,e){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,[(i=i.matrixTransform(t.getScreenCTM().inverse())).x,i.y]}var o=t.getBoundingClientRect();return[e.clientX-o.left-t.clientLeft,e.clientY-o.top-t.clientTop]}function ht(t){var e=ut();return e.changedTouches&&(e=e.changedTouches[0]),ct(t,e)}function ft(t,e,n){arguments.length<3&&(n=e,e=ut().changedTouches);for(var i,o=0,r=e?e.length:0;o<r;++o)if((i=e[o]).identifier===n)return ct(t,i);return null}
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */st.prototype=at.prototype={constructor:st,select:function(t){"function"!=typeof t&&(t=a(t));for(var e=this._groups,n=e.length,i=new Array(n),o=0;o<n;++o)for(var r,s,l=e[o],u=l.length,c=i[o]=new Array(u),h=0;h<u;++h)(r=l[h])&&(s=t.call(r,r.__data__,h,l))&&("__data__"in r&&(s.__data__=r.__data__),c[h]=s);return new st(i,this._parents)},selectAll:function(t){"function"!=typeof t&&(t=u(t));for(var e=this._groups,n=e.length,i=[],o=[],r=0;r<n;++r)for(var s,a=e[r],l=a.length,c=0;c<l;++c)(s=a[c])&&(i.push(t.call(s,s.__data__,c,a)),o.push(s));return new st(i,o)},filter:function(t){"function"!=typeof t&&(t=c(t));for(var e=this._groups,n=e.length,i=new Array(n),o=0;o<n;++o)for(var r,s=e[o],a=s.length,l=i[o]=[],u=0;u<a;++u)(r=s[u])&&t.call(r,r.__data__,u,s)&&l.push(r);return new st(i,this._parents)},data:function(t,e){if(!t)return g=new Array(this.size()),u=-1,this.each(function(t){g[++u]=t}),g;var n=e?p:d,i=this._parents,o=this._groups;"function"!=typeof t&&(t=function(t){return function(){return t}}(t));for(var r=o.length,s=new Array(r),a=new Array(r),l=new Array(r),u=0;u<r;++u){var c=i[u],h=o[u],f=h.length,g=t.call(c,c&&c.__data__,u,i),m=g.length,v=a[u]=new Array(m),y=s[u]=new Array(m);n(c,h,v,y,l[u]=new Array(f),g,e);for(var _,b,w=0,E=0;w<m;++w)if(_=v[w]){for(w>=E&&(E=w+1);!(b=y[E])&&++E<m;);_._next=b||null}}return(s=new st(s,i))._enter=a,s._exit=l,s},enter:function(){return new st(this._enter||this._groups.map(h),this._parents)},exit:function(){return new st(this._exit||this._groups.map(h),this._parents)},join:function(t,e,n){var i=this.enter(),o=this,r=this.exit();return i="function"==typeof t?t(i):i.append(t+""),null!=e&&(o=e(o)),null==n?r.remove():n(r),i&&o?i.merge(o).order():o},merge:function(t){for(var e=this._groups,n=t._groups,i=e.length,o=n.length,r=Math.min(i,o),s=new Array(i),a=0;a<r;++a)for(var l,u=e[a],c=n[a],h=u.length,f=s[a]=new Array(h),d=0;d<h;++d)(l=u[d]||c[d])&&(f[d]=l);for(;a<i;++a)s[a]=e[a];return new st(s,this._parents)},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i,o=t[e],r=o.length-1,s=o[r];--r>=0;)(i=o[r])&&(s&&4^i.compareDocumentPosition(s)&&s.parentNode.insertBefore(i,s),s=i);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=g);for(var n=this._groups,i=n.length,o=new Array(i),r=0;r<i;++r){for(var s,a=n[r],l=a.length,u=o[r]=new Array(l),c=0;c<l;++c)(s=a[c])&&(u[c]=s);u.sort(e)}return new st(o,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=new Array(this.size()),e=-1;return this.each(function(){t[++e]=this}),t},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],o=0,r=i.length;o<r;++o){var s=i[o];if(s)return s}return null},size:function(){var t=0;return this.each(function(){++t}),t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var o,r=e[n],s=0,a=r.length;s<a;++s)(o=r[s])&&t.call(o,o.__data__,s,r);return this},attr:function(t,e){var i=n(t);if(arguments.length<2){var o=this.node();return i.local?o.getAttributeNS(i.space,i.local):o.getAttribute(i)}return this.each((null==e?i.local?v:m:"function"==typeof e?i.local?w:b:i.local?_:y)(i,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?x:"function"==typeof e?M:k)(t,e,null==n?"":n)):T(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?L:"function"==typeof e?C:z)(t,e)):this.node()[t]},classed:function(t,e){var n=S(t+"");if(arguments.length<2){for(var i=A(this.node()),o=-1,r=n.length;++o<r;)if(!i.contains(n[o]))return!1;return!0}return this.each(("function"==typeof e?G:e?U:V)(n,e))},text:function(t){return arguments.length?this.each(null==t?I:("function"==typeof t?P:K)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?D:("function"==typeof t?R:j)(t)):this.node().innerHTML},raise:function(){return this.each(Z)},lower:function(){return this.each(H)},append:function(t){var e="function"==typeof t?t:r(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})},insert:function(t,e){var n="function"==typeof t?t:r(t),i=null==e?Y:"function"==typeof e?e:a(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})},remove:function(){return this.each(q)},clone:function(t){return this.select(t?W:X)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var i,o,r=function(t){return t.trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}})}(t+""),s=r.length;if(!(arguments.length<2)){for(a=e?et:tt,null==n&&(n=!1),i=0;i<s;++i)this.each(a(r[i],e,n));return this}var a=this.node().__on;if(a)for(var l,u=0,c=a.length;u<c;++u)for(i=0,l=a[u];i<s;++i)if((o=r[i]).type===l.type&&o.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?ot:it)(t,e))}};var dt=function(t,e){return dt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},dt(t,e)};function pt(t,e){function n(){this.constructor=t}dt(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function gt(t,e,n,i){var o,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,n,s):o(e,n))||s);return r>3&&s&&Object.defineProperty(e,n,s),s}function mt(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function vt(t,e,n,i){return new(n||(n=Promise))(function(e,o){function r(t){try{a(i.next(t))}catch(t){o(t)}}function s(t){try{a(i.throw(t))}catch(t){o(t)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(r,s)}a((i=i.apply(t,[])).next())})}function yt(t,e){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}var _t,bt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};
/*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */function wt(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(e[1]-t[1])*(n[0]-t[0])}function Et(t,e){return t[0]-e[0]||t[1]-e[1]}function xt(t){for(var e=t.length,n=[0,1],i=2,o=2;o<e;++o){for(;i>1&&wt(t[n[i-2]],t[n[i-1]],t[o])<=0;)--i;n[i++]=o}return n.slice(0,i)}function kt(t){if((n=t.length)<3)return null;var e,n,i=new Array(n),o=new Array(n);for(e=0;e<n;++e)i[e]=[+t[e][0],+t[e][1],e];for(i.sort(Et),e=0;e<n;++e)o[e]=[i[e][0],-i[e][1]];var r=xt(i),s=xt(o),a=s[0]===r[0],l=s[s.length-1]===r[r.length-1],u=[];for(e=r.length-1;e>=0;--e)u.push(t[i[r[e]][2]]);for(e=+a;e<s.length-l;++e)u.push(t[i[s[e]][2]]);return u}!function(t){!function(){var e="object"==typeof bt?bt:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),n=i(t);function i(t,e){return function(n,i){"function"!=typeof t[n]&&Object.defineProperty(t,n,{configurable:!0,writable:!0,value:i}),e&&e(n,i)}}void 0===e.Reflect?e.Reflect=t:n=i(e.Reflect,n),function(t){var e=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,i=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",o=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",r="function"==typeof Object.create,s={__proto__:[]}instanceof Array,a=!r&&!s,l={create:r?function(){return it(Object.create(null))}:s?function(){return it({__proto__:null})}:function(){return it({})},has:a?function(t,n){return e.call(t,n)}:function(t,e){return e in t},get:a?function(t,n){return e.call(t,n)?t[n]:void 0}:function(t,e){return t[e]}},u=Object.getPrototypeOf(Function),c="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,h=c||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?tt():Map,f=c||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?et():Set,d=new(c||"function"!=typeof WeakMap?nt():WeakMap);function p(t,e,n,i){if(U(n)){if(!Z(t))throw new TypeError;if(!Y(e))throw new TypeError;return k(t,e)}if(!Z(t))throw new TypeError;if(!I(e))throw new TypeError;if(!I(i)&&!U(i)&&!V(i))throw new TypeError;return V(i)&&(i=void 0),M(t,e,n=R(n),i)}function g(t,e){function n(n,i){if(!I(n))throw new TypeError;if(!U(i)&&!q(i))throw new TypeError;A(t,e,n,i)}return n}function m(t,e,n,i){if(!I(n))throw new TypeError;return U(i)||(i=R(i)),A(t,e,n,i)}function v(t,e,n){if(!I(e))throw new TypeError;return U(n)||(n=R(n)),L(t,e,n)}function y(t,e,n){if(!I(e))throw new TypeError;return U(n)||(n=R(n)),z(t,e,n)}function _(t,e,n){if(!I(e))throw new TypeError;return U(n)||(n=R(n)),C(t,e,n)}function b(t,e,n){if(!I(e))throw new TypeError;return U(n)||(n=R(n)),S(t,e,n)}function w(t,e){if(!I(t))throw new TypeError;return U(e)||(e=R(e)),O(t,e)}function E(t,e){if(!I(t))throw new TypeError;return U(e)||(e=R(e)),B(t,e)}function x(t,e,n){if(!I(e))throw new TypeError;U(n)||(n=R(n));var i=T(e,n,!1);if(U(i))return!1;if(!i.delete(t))return!1;if(i.size>0)return!0;var o=d.get(e);return o.delete(n),o.size>0||d.delete(e),!0}function k(t,e){for(var n=t.length-1;n>=0;--n){var i=(0,t[n])(e);if(!U(i)&&!V(i)){if(!Y(i))throw new TypeError;e=i}}return e}function M(t,e,n,i){for(var o=t.length-1;o>=0;--o){var r=(0,t[o])(e,n,i);if(!U(r)&&!V(r)){if(!I(r))throw new TypeError;i=r}}return i}function T(t,e,n){var i=d.get(t);if(U(i)){if(!n)return;i=new h,d.set(t,i)}var o=i.get(e);if(U(o)){if(!n)return;o=new h,i.set(e,o)}return o}function L(t,e,n){if(z(t,e,n))return!0;var i=Q(e);return!V(i)&&L(t,i,n)}function z(t,e,n){var i=T(e,n,!1);return!U(i)&&D(i.has(t))}function C(t,e,n){if(z(t,e,n))return S(t,e,n);var i=Q(e);return V(i)?void 0:C(t,i,n)}function S(t,e,n){var i=T(e,n,!1);if(!U(i))return i.get(t)}function A(t,e,n,i){T(n,i,!0).set(t,e)}function O(t,e){var n=B(t,e),i=Q(t);if(null===i)return n;var o=O(i,e);if(o.length<=0)return n;if(n.length<=0)return o;for(var r=new f,s=[],a=0,l=n;a<l.length;a++){var u=l[a];r.has(u)||(r.add(u),s.push(u))}for(var c=0,h=o;c<h.length;c++){u=h[c];r.has(u)||(r.add(u),s.push(u))}return s}function B(t,e){var n=[],i=T(t,e,!1);if(U(i))return n;for(var o=W(i.keys()),r=0;;){var s=$(o);if(!s)return n.length=r,n;var a=F(s);try{n[r]=a}catch(t){try{J(o)}finally{throw t}}r++}}function N(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function U(t){return void 0===t}function V(t){return null===t}function G(t){return"symbol"==typeof t}function I(t){return"object"==typeof t?null!==t:"function"==typeof t}function K(t,e){switch(N(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var n="string",o=X(t,i);if(void 0!==o){var r=o.call(t,n);if(I(r))throw new TypeError;return r}return P(t)}function P(t,e){var n,i,o=t.toString;if(H(o)&&!I(i=o.call(t)))return i;if(H(n=t.valueOf)&&!I(i=n.call(t)))return i;throw new TypeError}function D(t){return!!t}function j(t){return""+t}function R(t){var e=K(t);return G(e)?e:j(e)}function Z(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function H(t){return"function"==typeof t}function Y(t){return"function"==typeof t}function q(t){switch(N(t)){case 3:case 4:return!0;default:return!1}}function X(t,e){var n=t[e];if(null!=n){if(!H(n))throw new TypeError;return n}}function W(t){var e=X(t,o);if(!H(e))throw new TypeError;var n=e.call(t);if(!I(n))throw new TypeError;return n}function F(t){return t.value}function $(t){var e=t.next();return!e.done&&e}function J(t){var e=t.return;e&&e.call(t)}function Q(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===u)return e;if(e!==u)return e;var n=t.prototype,i=n&&Object.getPrototypeOf(n);if(null==i||i===Object.prototype)return e;var o=i.constructor;return"function"!=typeof o||o===t?e:o}function tt(){var t={},e=[],n=function(){function t(t,e,n){this._index=0,this._keys=t,this._values=e,this._selector=n}return t.prototype["@@iterator"]=function(){return this},t.prototype[o]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var n=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var n=this._find(t,!0);return this._values[n]=e,this},e.prototype.delete=function(e){var n=this._find(e,!1);if(n>=0){for(var i=this._keys.length,o=n+1;o<i;o++)this._keys[o-1]=this._keys[o],this._values[o-1]=this._values[o];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new n(this._keys,this._values,i)},e.prototype.values=function(){return new n(this._keys,this._values,r)},e.prototype.entries=function(){return new n(this._keys,this._values,s)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[o]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function i(t,e){return t}function r(t,e){return e}function s(t,e){return[t,e]}}function et(){return function(){function t(){this._map=new h}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[o]=function(){return this.keys()},t}()}function nt(){var t=16,n=l.create(),i=o();return function(){function t(){this._key=o()}return t.prototype.has=function(t){var e=r(t,!1);return void 0!==e&&l.has(e,this._key)},t.prototype.get=function(t){var e=r(t,!1);return void 0!==e?l.get(e,this._key):void 0},t.prototype.set=function(t,e){return r(t,!0)[this._key]=e,this},t.prototype.delete=function(t){var e=r(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=o()},t}();function o(){var t;do{t="@@WeakMap@@"+u()}while(l.has(n,t));return n[t]=!0,t}function r(t,n){if(!e.call(t,i)){if(!n)return;Object.defineProperty(t,i,{value:l.create()})}return t[i]}function s(t,e){for(var n=0;n<e;++n)t[n]=255*Math.random()|0;return t}function a(t){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):s(new Uint8Array(t),t):s(new Array(t),t)}function u(){var e=a(t);e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var n="",i=0;i<t;++i){var o=e[i];4!==i&&6!==i&&8!==i||(n+="-"),o<16&&(n+="0"),n+=o.toString(16).toLowerCase()}return n}}function it(t){return t.__=void 0,delete t.__,t}t("decorate",p),t("metadata",g),t("defineMetadata",m),t("hasMetadata",v),t("hasOwnMetadata",y),t("getMetadata",_),t("getOwnMetadata",b),t("getMetadataKeys",w),t("getOwnMetadataKeys",E),t("deleteMetadata",x)}(n)}()}(_t||(_t={}));var Mt=function(){function t(t){return this.parent=t,this.node=null,this.autoGenerate=!1,this.child_index=null,this.domText=null,this.child_items=[],this.dom_attrs=[],this.dom_classes=[],this.tags=[],this.eventCode=null,void 0!==t.global&&(this.global=t.global),Object(this).dom_params&&(Object(this).dom_params.tag&&(this.domTag=Object(this).dom_params.tag),Object(this).dom_params.class&&(this.domClass=Object(this).dom_params.class),Object(this).dom_params.event_code&&(this.eventCode=Object(this).dom_params.event_code)),void 0!==Object(this).dom_params.autoGenerate&&!0===Object(this).dom_params.autoGenerate&&(this.autoGenerate=!0),this.generateThisDom(),this}return t.prototype.generateThisDom=function(){return this.autoGenerate&&(this.domGenerate(this.parent.node),this.afterGenerate()),this},t.prototype.domGenerate=function(t,e){void 0===e&&(e=0);var n=this.domTag?this.domTag:"g";this.child_index=e,this.node=t.datum(this.parent).append(n);for(var i=0;i<this.dom_attrs.length;i++){var o=this.dom_attrs[i];this.node.attr(o.name,o.value)}this.domText&&this.node.text(this.domText),this.domClass&&this.node.classed(this.domClass,!0);for(var r=0;r<this.dom_classes.length;r++){var s=this.dom_classes[r];this.node.classed(s.name,s.value)}return this},t.prototype.attr=function(t,e){return this.dom_attrs.push({name:t,value:e}),this},t.prototype.text=function(t){return this.domText=t,this},t.prototype.addChild=function(t,e,n){return vt(this,0,void 0,function(){var n,i;return yt(this,function(o){for(n in e)i=e[n],t.dom_attrs.push({name:n,value:i});return this.child_items.push(t),[2,this]})})},t.prototype.classed=function(t,e){return void 0===e&&(e=!0),this.dom_classes.push({name:t,value:e}),this},t.prototype.clear=function(){return this.child_items.map(function(t){t.node.remove()}),this.child_items=[],this},t.prototype.updateChilds=function(){return vt(this,0,void 0,function(){var t=this;return yt(this,function(e){return this.child_items.map(function(e,n){e.domGenerate(t.node,n),e.update()}),this.afterGenerate(),this.updateEvents(!1),[2,this]})})},t.prototype.updateEvents=function(t){void 0===t&&(t=!1);var e=this,n=["click","mousever","mouseleave","mouseout","mouseenter","mousemove","keydown","keypress","mousedown","mouseup","touchstart"];if(this.eventCode){for(var i=function(t){var i=o.global.eventManager.events[t],r=i.type.toString().split(".");r[0].toLowerCase()===o.eventCode.toLowerCase()&&-1!==n.indexOf(r[1].toLowerCase())&&void 0!==r[1]&&o.node.on(r[1].toLowerCase()+".globalevent",function(t){var n=ht(e.parent.node.node());i.fn(e,t,n)})},o=this,r=0;r<this.global.eventManager.events.length;r++)i(r);t&&this.child_items.length>0&&this.child_items.map(function(t){"function"==typeof t.updateEvents&&t.updateEvents(!0)})}return this},t.prototype.addEventListener=function(t,e){return this.global.eventManager.addEventListener(t,e),this.updateEvents(!1),this},t.prototype.addTag=function(t){return this.tags.push(t),this},t.prototype.hasTag=function(t){return-1!==this.tags.indexOf(t)},t.prototype.getChilds=function(t){return void 0===t&&(t=null),null===t?this.child_items.filter(function(e){return e.constructor.name===t}):this.child_items},t.prototype.getChildCount=function(){return this.child_items.length},t.prototype.beforeGenerate=function(){},t.prototype.afterGenerate=function(){},t.prototype.addToParent=function(){return this.parent.addChild(this),this},t.prototype.addTo=function(t){return t.addChild(this),this},t}();function Tt(t){return function(e){e.prototype.dom_params={},t.tag&&(e.prototype.dom_params.tag=t.tag),t.class&&(e.prototype.dom_params.class=t.class),t.event_code?e.prototype.dom_params.event_code=t.event_code:t.class&&(e.prototype.dom_params.event_code=t.class),void 0!==t.autoGenerate?e.prototype.dom_params.autoGenerate=t.autoGenerate:e.prototype.dom_params.autoGenerate=!0}}function Lt(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}var zt,Ct,St,At,Ot=(zt="application/xml",function(t,e){return function(t,e){return fetch(t,e).then(Lt)}(t,e).then(function(t){return(new DOMParser).parseFromString(t,zt)})}),Bt=function(){this.child_index=null,this.item_type=null},Nt=function(t){function e(e){var n=t.call(this)||this;return n.tags=[],n.tag_index={},n.id=e.id,n.x=e.x,n.y=e.y,n.title=e.title||null,n.color=e.color||null,n.block=e.block,n.note=e.note||null,n.salable=!1!==e.salable||e.salable,n.selected=e.selected||!1,n.tags=e.tags||[],n.custom_data=e.custom_data||{},n.tag_index={},n.svg=null,n.icon=null,n}return pt(e,t),e.prototype.selectedToggle=function(){return this.selected=!0!==this.selected,this.selected},e.prototype.addTag=function(t){this.tag_index[t]||(this.tag_index[t]=!0,this.tags.push(t))},e.prototype.removeTags=function(t){},e.prototype.toJson=function(){return{id:this.id,x:this.x,y:this.y,salable:this.salable,note:this.note,color:this.color,block:this.block.toJson()}},e}(Bt),Ut=function(t){function e(e){var n=t.call(this)||this;return n.x=e.x,n.y=e.y,n.title=e.title,n.block=e.block,n}return pt(e,t),e}(Bt),Vt=function(t){function e(e){var n=t.call(this)||this;return n.id=e.id?e.id:(1e3*Math.random()).toString(),n.width=e.width||null,n.height=e.height||null,n.x=e.x||null,n.y=e.y||null,n.bounds=e._bounds||[],n.color=e.color||"#f1f1f1",n.border_color=e.border_color||"#f1f1f1",n.title=e.title,n.rotate=e.rotate||0,n.gap=e.gap||12,n.labels=e.labels.map(function(t){return t.block=n,new Ut(t)})||[],n.seats=e.seats.map(function(t){return t.block=n,new Nt(t)})||[],n}return pt(e,t),e.prototype.toJson=function(){return{id:this.id,title:this.title,x:this.x,y:this.y,color:this.color,width:this.width,height:this.height}},e}(Bt),Gt=function(t){function e(e){var n=t.call(this,e)||this;return n.parent=e,n.attr("block-id",e.item.block.id),n.attr("r",n.global.config.style.seat.radius),n.attr("fill",n.global.config.style.seat.color),n.attr("stroke","rgba(0,0,0,0.3)"),n.attr("stroke-width",1),n}return pt(e,t),e.prototype.update=function(){return this},e=gt([Tt({tag:"circle",class:"seat-circle",autoGenerate:!1}),mt("design:paramtypes",[Rt])],e)}(Mt),It=function(){function t(t){this.x=t.x||0,this.y=t.y||0}return t.prototype.toArray=function(){return[this.x,this.y]},t.prototype.toJson=function(){return{}},t}();!function(t){t.ADD_BLOCK="BLOCK.ADD",t.REMOVE_BLOCK="BLOCK.REMOVE",t.CLICK_BLOCK="BLOCK.CLICK",t.MOUSEENTER_BLOCK="BLOCK.MOUSEENTER",t.TOUCHSTART_BLOCK="BLOCK.TOUCHSTART",t.MOUSEDOWN_BLOCK="BLOCK.MOUSEDOWN",t.MOUSEUP_BLOCK="BLOCK.MOUSEUP",t.MOUSEMOVE_BLOCK="BLOCK.MOUSEMOVE",t.MOUSELEAVE_BLOCK="BLOCK.MOUSELEAVE",t.UPDATE_BLOCK="BLOCK.UPDATE",t.CLICK_SEAT="SEAT.CLICK",t.TOUCHSTART_SEAT="SEAT.TOUCHSTART",t.MOUSEMOVE_SEAT="SEAT.MOUSEMOVE",t.MOUSEDOWN_SEAT="SEAT.MOUSEDOWN",t.MOUSEENTER_SEAT="SEAT.MOUSEENTER",t.MOUSELEAVE_SEAT="SEAT.MOUSELEAVE",t.MOUSEOUT_SEAT="SEAT.MOUSEOUT",t.ADD_SEAT="SEAT.ADD",t.REMOVE_SEAT="SEAT.REMOVE",t.ZOOM_LEVEL_CHANGE="ZOOM_LEVEL_CHANGE",t.BOUND_CLICK="BOUND.CLICK",t.MOUSE_MOVE="MOUSE.MOVE",t.RESIZE_WINDOW="WINDOW.RESIZE",t.CLICK_ZOOM_OUT="ZOOM-OUT-BG.CLICK",t.MOUSEMOVE_ZOOM_OUT="ZOOM-OUT-BG.MOUSEMOVE",t.KEYDOWN_SVG="KEYDOWN.SEATMAP-SVG",t.KEYUP_SVG="KEYUP.SEATMAP-SVG",t.MULTI_SELECT_ENABLE="MULTI_SELECT_ENABLE",t.MULTI_SELECT_DISABLE="MULTI_SELECT_DISABLE",t.BEST_AVAILABLE_ENABLE="BEST_AVAILABLE_ENABLE",t.MBEST_AVAILABLE_DISABLE="MBEST_AVAILABLE_DISABLE",t.READY="READY"}(Ct||(Ct={})),function(t){t.VENUE="VENUE",t.BLOCK="BLOCK",t.SEAT="SEAT"}(St||(St={})),function(t){t.HOVER="hover",t.FOCUS="focus",t.LEAVE="leave",t.SELECT="select",t.NORMAL="normal"}(At||(At={}));var Kt=function(t){function e(e){var n=t.call(this,e)||this;return n.parent=e,n.attr("d","M12.9,953.7l-6.3,6.5l-2.9-2.5l-2.1,2.4l4.1,3.5l1.1,1l1.1-1.1l7.3-7.6L12.9,953.7L12.9,953.7z"),n.attr("fill",n.global.config.style.seat.check_color),n.attr("transform","translate(-8,-959.36218)"),n.attr("pointer-events","none"),n.attr("display","none"),n}return pt(e,t),e.prototype.update=function(){return this},e.prototype.afterGenerate=function(){this.node.style("pointer-events","none")},e.prototype.show=function(){return this.node.attr("display","block"),this},e.prototype.hide=function(){return this.node.attr("display","none"),this},e=gt([Tt({tag:"path",class:"seat-check",autoGenerate:!1}),mt("design:paramtypes",[Rt])],e)}(Mt),Pt=function(t){function e(e){var n=t.call(this,e)||this;return n.parent=e,n.attr("fill",n.global.config.style.label.color),n.attr("opacity",0),n.attr("r",n.global.config.style.seat.radius/1.5),n.attr("transform","translate(".concat(n.global.config.style.seat.radius/2,",560)")),n}return pt(e,t),e.prototype.update=function(){return this},e=gt([Tt({tag:"circle",class:"circle-area",autoGenerate:!1}),mt("design:paramtypes",[Dt])],e)}(Mt),Dt=function(t){function e(e,n){var i=t.call(this,e)||this;return i.parent=e,i.customSvg=n,i.attr("transform","translate(".concat(i.global.config.style.seat.radius/2*-1,",-560)")),i}return pt(e,t),e.prototype.update=function(){return this.updateChilds(),this},e.prototype.domGenerate=function(e,n){void 0===n&&(n=0),t.prototype.domGenerate.call(this,e,n);var i=lt(this.customSvg.documentElement.cloneNode(!0));return i.attr("width",this.global.config.style.seat.radius),i.attr("viewBox","0 0 ".concat(this.global.config.style.seat.radius," ").concat(this.global.config.style.seat.radius)),this.node.node().append(i.node()),this.addChild(new Pt(this)),this},e=gt([Tt({tag:"g",class:"seat-circle",autoGenerate:!1}),mt("design:paramtypes",[Rt,Object])],e)}(Mt),jt=function(t){function e(e){var n=t.call(this,e)||this;return n.parent=e,n.attr("r",n.global.config.style.seat.radius/2),n.attr("fill",n.global.config.style.seat.check_color),n.attr("transform","translate(0,0)"),n.attr("pointer-events","none"),n.attr("opacity",0),n.attr("stroke","rgba(0,0,0,0.3)"),n.attr("stroke-width",1),n}return pt(e,t),e.prototype.update=function(){return this},e.prototype.afterGenerate=function(){this.node.style("pointer-events","none")},e.prototype.show=function(){return this.node.transition().duration(150).attr("r",this.global.config.style.seat.radius/1.3).attr("opacity",1),this},e.prototype.hide=function(){return this.node.attr("r",this.global.config.style.seat.radius/4),this.node.attr("opacity",0),this},e=gt([Tt({tag:"circle",class:"seat-check",autoGenerate:!1}),mt("design:paramtypes",[Rt])],e)}(Mt),Rt=function(t){function e(e,n,i){var o=t.call(this,e)||this;return o.parent=e,o.item=n,o.coordinates=new It(n),o.seatCustomSvg=i,o.attr("transform","translate("+o.coordinates.toArray()+")"),o.item.svg=o,o}return pt(e,t),e.prototype.setColor=function(t,e){if(void 0===e&&(e=!1),this.seatCustomSvg)this.circle.node.attr("fill",t);else if(e)this.circle.node.transition().duration(this.global.config.animation_speed).attr("fill",t);else try{this.circle.node.attr("fill",t)}catch(t){console.log("err",t)}return this},e.prototype.updateColor=function(t){return this.setColor(this.getColor()),this},e.prototype.select=function(t){return this.isSalable()?(this.item.selected=!0,this.node.classed("selected",!0),this.seatCustomSvg,this.circle.node.attr("fill",this.global.config.style.seat.selected),this.check.show(),this):this},e.prototype.unSelect=function(){return this.item.selected=!1,this.node.classed("selected",!1),this.seatCustomSvg,this.circle.node.attr("fill",this.global.config.style.seat.color),this.check.hide(),this},e.prototype.isSelected=function(){return this.item.selected},e.prototype.isSalable=function(){return this.item.salable},e.prototype.hover=function(){this.setColor(this.global.config.style.seat.hover)},e.prototype.blur=function(){this.setColor(this.getColor())},e.prototype.getColor=function(t){return void 0===t&&(t=null),this.isSalable()?t==At.FOCUS?this.isSelected()?this.global.config.style.seat.focus_out:this.global.config.style.seat.focus:t==At.HOVER?this.isSelected()?this.global.config.style.seat.selected:this.global.config.style.seat.hover:t==At.LEAVE?this.isSelected()?this.global.config.style.seat.selected:this.global.config.style.seat.color:t==At.SELECT?(this.isSelected(),this.global.config.style.seat.selected):this.isSelected()?this.global.config.style.seat.selected:this.global.config.style.seat.color:this.global.config.style.seat.not_salable},e.prototype.update=function(){return this.seatCustomSvg?(this.check=new jt(this).addTo(this),this.circle=new Dt(this,this.seatCustomSvg),this.addChild(this.circle)):(this.circle=new Gt(this),this.addChild(this.circle),this.check=new Kt(this).addTo(this)),this.updateChilds(),this},e.prototype.afterGenerate=function(){this.setColor(this.getColor()),this.item.selected?this.check.show():this.check.hide()},e=gt([Tt({tag:"g",class:"seat",autoGenerate:!1}),mt("design:paramtypes",[Zt,Nt,Object])],e)}(Mt),Zt=function(t){function e(e,n){var i=t.call(this,e)||this;return i.parent=e,i.item=n,i.global.eventManager.addEventListener(Ct.MOUSEENTER_SEAT,function(t){i.global.multi_select||t.setColor(t.getColor(At.HOVER))}),i.global.eventManager.addEventListener(Ct.MOUSELEAVE_SEAT,function(t){t.setColor(t.getColor())}),i}return pt(e,t),e.prototype.update=function(){return vt(this,0,void 0,function(){var t,e,n,i;return yt(this,function(o){switch(o.label){case 0:return this.global.config.style.seat.svg?[4,Ot(this.global.config.style.seat.svg)]:[3,2];case 1:t=o.sent(),o.label=2;case 2:e=0,n=this.item.seats,o.label=3;case 3:return e<n.length?(i=n[e],[4,this.addChild(new Rt(this,i,t),{id:i.id})]):[3,6];case 4:o.sent(),o.label=5;case 5:return e++,[3,3];case 6:return[4,this.updateChilds()];case 7:return o.sent(),[2,this]}})})},e.prototype.getSeat=function(t){return this.child_items.find(function(e){return e.item.id==t})},e.prototype.getSeats=function(){return this.child_items},e.prototype.getSeatsCount=function(){return this.child_items.length},e.prototype.getSeatByIndex=function(t){return this.child_items[t]},e.prototype.resetSeatsColors=function(t){void 0===t&&(t=!1);for(var e=0;e<this.getSeatsCount();e++){var n=this.getSeatByIndex(e);n.item;var i=n.getColor();!n.isSelected()&&n.isSalable()&&(i=n.getColor(At.LEAVE),n.setColor(i,t))}},e=gt([Tt({tag:"g",class:"seats",autoGenerate:!1}),mt("design:paramtypes",[te,Vt])],e)}(Mt),Ht=function(t){function e(e){var n=t.call(this,e)||this;return n.parent=e,n.attr("fill",n.global.config.style.block.title_color),n.attr("font-size",48),n}return pt(e,t),e.prototype.update=function(){return this},e=gt([Tt({tag:"text",class:"title",autoGenerate:!1}),mt("design:paramtypes",[Yt])],e)}(Mt),Yt=function(t){function e(e,n){var i=t.call(this,e)||this;i.parent=e,i.item=n,i.attr("opacity",0);var o=(i.item.bounds[1][0]-i.item.bounds[2][0])/2+i.item.bounds[2][0],r=(i.item.bounds[0][1]-i.item.bounds[1][1])/2+i.item.bounds[1][1];return i.attr("transform","translate("+[o,r]+")"),i}return pt(e,t),e.prototype.update=function(){return this.title=new Ht(this),this.addChild(this.title),this.updateChilds(),this.title.node.text(this.parent.item.title),this},e=gt([Tt({tag:"g",class:"info",autoGenerate:!1}),mt("design:paramtypes",[te,Vt])],e)}(Mt),qt=function(t){function e(e,n){var i=t.call(this,e)||this;return i.parent=e,i.item=n,i}return pt(e,t),e.prototype.show=function(){this.node.classed("bound-hide",!1)},e.prototype.hide=function(){this.node.classed("bound-hide",!0)},e.prototype.update=function(){return this.updateChilds(),this.node.datum(this.item.bounds).attr("d",function(t){return"M"+t.join("L")+"Z"}),this},e=gt([Tt({tag:"path",class:"bound",autoGenerate:!1}),mt("design:paramtypes",[Object,Vt])],e)}(Mt),Xt=function(t){function e(e,n){var i=t.call(this,e)||this;return i.parent=e,i.item=n,i}return pt(e,t),e.prototype.update=function(){return this.bound1=new qt(this,this.item),this.bound1.attr("fill",this.parent.item.border_color),this.bound1.attr("stroke-width",70),this.bound1.attr("stroke",this.parent.item.border_color),this.bound1.classed("block-hull-border"),this.bound2=new qt(this,this.item),this.bound2.attr("fill",this.item.color),this.bound2.attr("stroke-width",60),this.bound2.attr("stroke",this.item.color),this.bound2.classed("block-hull"),this.addChild(this.bound1),this.addChild(this.bound2),this.updateChilds(),this},e=gt([Tt({tag:"g",class:"bounds",autoGenerate:!1}),mt("design:paramtypes",[te,Vt])],e)}(Mt),Wt=function(t){function e(e,n){var i=t.call(this,e)||this;return i.parent=e,i.item=n,i.global.eventManager.addEventListener(Ct.BOUND_CLICK,function(t){if(!i.global.multi_select){var n=t.parent.parent.item;t.hasTag("block-level")?e.global.zoomManager.zoomToBlock(n.id):t.hasTag("seat-level")&&e.global.zoomManager.zoomToSelection()}}),i}return pt(e,t),e.prototype.update=function(){return this.seatLevelMask=new qt(this,this.item),this.seatLevelMask.attr("fill",this.item.color),this.seatLevelMask.attr("stroke-width",59),this.seatLevelMask.attr("stroke",this.item.color),this.seatLevelMask.tags.push("seat-level"),this.seatLevelMask.classed("seat-level-mask"),this.blockLevelMask=new qt(this,this.item),this.blockLevelMask.attr("fill",this.item.color),this.blockLevelMask.attr("stroke-width",59),this.blockLevelMask.attr("stroke",this.item.color),this.blockLevelMask.tags.push("block-level"),this.blockLevelMask.classed("block-level-mask"),this.addChild(this.seatLevelMask),this.addChild(this.blockLevelMask),this.updateChilds(),this},e=gt([Tt({tag:"g",class:"masks",autoGenerate:!1}),mt("design:paramtypes",[te,Vt])],e)}(Mt),Ft=function(t){function e(e){var n=t.call(this,e)||this;return n.parent=e,n.attr("r",n.global.config.style.label.radius),n.attr("fill",n.global.config.style.label.bg),n}return pt(e,t),e.prototype.update=function(){return this},e=gt([Tt({tag:"circle",class:"label-circle",autoGenerate:!1}),mt("design:paramtypes",[Jt])],e)}(Mt),$t=function(t){function e(e){var n=t.call(this,e)||this;return n.parent=e,n.attr("fill",n.global.config.style.label.color),n.attr("font-size",n.global.config.style.label.font_size),n}return pt(e,t),e.prototype.update=function(){return this},e=gt([Tt({tag:"text",class:"label-text",autoGenerate:!1}),mt("design:paramtypes",[Jt])],e)}(Mt),Jt=function(t){function e(e,n){var i=t.call(this,e)||this;return i.parent=e,i.item=n,i.coordinates=new It(n),i.attr("transform","translate("+i.coordinates.toArray()+")"),i}return pt(e,t),e.prototype.update=function(){return this.circle=new Ft(this),this.addChild(this.circle),this.circle=new $t(this),this.addChild(this.circle),this.updateChilds(),this.circle.node.text(this.item.title),this},e=gt([Tt({tag:"g",class:"label",autoGenerate:!1}),mt("design:paramtypes",[Qt,Ut])],e)}(Mt),Qt=function(t){function e(e,n){var i=t.call(this,e)||this;return i.parent=e,i.item=n,i}return pt(e,t),e.prototype.update=function(){var t=this;return this.item.labels.map(function(e){t.addChild(new Jt(t,e))}),this.updateChilds(),this},e.prototype.getLabels=function(){return this.child_items},e=gt([Tt({tag:"g",class:"labels",autoGenerate:!1}),mt("design:paramtypes",[te,Vt])],e)}(Mt),te=function(t){function e(e,n){var i=t.call(this,e)||this;return i.parent=e,i.item=n,i.center_position={x:null,y:null},i.top_position={x:null,y:null},i.attr("id",n.id),i.attr("opacity",0),i.global.eventManager.addEventListener(Ct.ZOOM_LEVEL_CHANGE,function(t){t.level===St.VENUE?(i.mask.blockLevelMask.show(),i.mask.seatLevelMask.show(),i.seats.resetSeatsColors(!1),i.infosToCenter()):t.level===St.BLOCK?(i.mask.blockLevelMask.hide(),i.mask.seatLevelMask.show(),i.infosToTop()):t.level===St.SEAT&&(i.mask.blockLevelMask.hide(),i.mask.seatLevelMask.hide(),i.seats.resetSeatsColors(!1),i.infosToTop())}),i.global.eventManager.addEventListener(Ct.MULTI_SELECT_ENABLE,function(){i.seats.resetSeatsColors(!1)}),i.global.eventManager.addEventListener(Ct.MULTI_SELECT_DISABLE,function(){i.seats.resetSeatsColors(!1)}),i.global.eventManager.addEventListener(Ct.MOUSEMOVE_BLOCK,function(t){if(i.parent.parent.searchCircle.is_enable&&!i.global.multi_select){var e=ht(i.parent.parent.blocks.node.node()),n=i.global.config.zoom_focus_circle_radius;if(i.global.zoomManager.zoomLevel===St.BLOCK)for(var o=0;o<t.seats.getSeatsCount();o++){var r=t.seats.getSeatByIndex(o),s=r.item,a=r.getColor();r.isSelected()?a=r.getColor(At.SELECT):(s.x-n<e[0]&&s.x+n>e[0]&&s.y-n<e[1]&&s.y+n>e[1]&&(a=r.getColor(At.FOCUS)),r.setColor(a))}}}),i.global.eventManager.addEventListener(Ct.MOUSELEAVE_BLOCK,function(t){i.seats.resetSeatsColors()}),i.parent.node.on("mouseleave.seats",function(){i.seats.resetSeatsColors(!1)}),i}return pt(e,t),e.prototype.update=function(){return this.bounds=new Xt(this,this.item),this.addChild(this.bounds),this.seats=new Zt(this,this.item),this.addChild(this.seats),this.labels=new Qt(this,this.item),this.addChild(this.labels),this.mask=new Wt(this,this.item),this.addChild(this.mask),this.info=new Yt(this,this.item),this.addChild(this.info),this.center_position.x=(this.item.bounds[1][0]-this.item.bounds[2][0])/2+this.item.bounds[2][0],this.center_position.y=(this.item.bounds[0][1]-this.item.bounds[1][1])/2+this.item.bounds[1][1],this.top_position.x=this.center_position.x,this.top_position.y=this.item.bounds[1][1]-60,this.updateChilds(),this.infosToCenter(),this.node.interrupt().transition().duration(this.global.config.animation_speed).attr("opacity",1),this.node.attr("transform-origin","".concat(this.center_position.x," ").concat(this.center_position.y)),this.item.rotate&&this.node.attr("transform","rotate("+this.item.rotate+")"),this},e.prototype.infosToTop=function(){this.info.node&&this.top_position.x&&(this.info.node.interrupt().transition().duration(this.global.config.animation_speed).attr("transform","translate("+this.top_position.x+","+this.top_position.y+")").attr("opacity",.8).attr("font-size",14),this.info.title.node.transition().duration(this.global.config.animation_speed).attr("fill",this.item.color))},e.prototype.infosToCenter=function(){this.info.node&&this.center_position.x&&(this.info.node.interrupt().transition().duration(this.global.config.animation_speed).attr("transform","translate("+this.center_position.x+","+this.center_position.y+")").attr("opacity",1).attr("font-size",32),this.info.title.node.transition().duration(this.global.config.animation_speed).attr("fill",this.global.config.style.block.title_color))},e=gt([Tt({tag:"g",class:"block",autoGenerate:!1}),mt("design:paramtypes",[ee,Vt])],e)}(Mt),ee=function(t){function e(e){var n=t.call(this,e)||this;return n.parent=e,n}return pt(e,t),e.prototype.update=function(){var t=this;return this.clear(),this.global.data.getBlocks().map(function(e){var n=new te(t,e),i=e.seats;i&&i.length&&(i[0].y+=1e-4,i[0].x+=1e-4);var o=i.map(function(t){return[t.x,t.y]}).concat(e.labels.map(function(t){return[t.x,t.y]}));e.bounds=kt(o);var r=function(t){for(var e,n,i=-1,o=t.length,r=0,s=0,a=t[o-1],l=0;++i<o;)e=a,a=t[i],l+=n=e[0]*a[1]-a[0]*e[1],r+=(e[0]+a[0])*n,s+=(e[1]+a[1])*n;return[r/(l*=3),s/l]}(e.bounds);t.scalePolygon(e.bounds,1.4,r);var s=t.expandPolygon(e.bounds,e.gap,r);e.bounds=kt(s),t.addChild(n)}),this.updateChilds(),this.seats=this.node.selectAll(".seat"),this},e.prototype.getBlock=function(t){var e=this.getBlocks().find(function(e){return e.item.id==t});return e||null},e.prototype.getBlocks=function(){return this.getChilds(te.name)},e.prototype.center=function(){},e.prototype.scalePolygon=function(t,e,n){return t.map(function(t){var i=t[0],o=t[1];return[n[0]+(i-n[0])*e,n[1]+(o-n[1])*e]})},e.prototype.expandPolygon=function(t,e,n){return t.map(function(t){var i=t[0],o=t[1],r=i-n[0],s=o-n[1],a=Math.sqrt(r*r+s*s);return[i+r/a*e,o+s/a*e]})},e=gt([Tt({tag:"g",class:"blocks",autoGenerate:!1}),mt("design:paramtypes",[oe])],e)}(Mt),ne=function(t){function e(e){var n=t.call(this,e)||this;return n.parent=e,n.attr("r",n.parent.global.config.zoom_focus_circle_radius),n}return pt(e,t),e.prototype.update=function(){return this.updateChilds(),this},e=gt([Tt({tag:"circle",class:"circle",autoGenerate:!1}),mt("design:paramtypes",[ie])],e)}(Mt),ie=function(t){function e(e){var n=t.call(this,e)||this;return n.parent=e,n.is_enable=!0,n.global.eventManager.addEventListener(Ct.MOUSE_MOVE,function(t){n.global.zoomManager.zoomLevel===St.BLOCK&&n.is_enable&&n.node.attr("transform","translate("+t+")")}),n.global.eventManager.addEventListener(Ct.ZOOM_LEVEL_CHANGE,function(t){t.level!==St.VENUE&&t.level!==St.SEAT||n.node.classed("show",!1)}),n.global.eventManager.addEventListener(Ct.MULTI_SELECT_ENABLE,function(){n.disable()}),n.global.eventManager.addEventListener(Ct.MULTI_SELECT_DISABLE,function(){n.enable()}),n}return pt(e,t),e.prototype.update=function(){var t=this;return this.clear(),this.circle=new ne(this),this.addChild(this.circle),this.updateChilds(),this.parent.blocks.node.on("mouseleave.search",function(){t.node.classed("show",!1)}),this.parent.blocks.node.on("mousemove.search",function(){t.global.zoomManager.zoomLevel===St.VENUE?t.node.classed("show",!1):t.global.zoomManager.zoomLevel===St.BLOCK?t.node.classed("show",!0):t.global.zoomManager.zoomLevel===St.SEAT&&t.node.classed("show",!1)}),this},e.prototype.enable=function(){return this.is_enable=!0,this.node.style("display","block"),this},e.prototype.disable=function(){return this.is_enable=!1,this.node.style("display","none"),this},e=gt([Tt({tag:"g",class:"search-circle",autoGenerate:!1}),mt("design:paramtypes",[oe])],e)}(Mt),oe=function(t){function e(e){var n=t.call(this,e)||this;return n.parent=e,n}return pt(e,t),e.prototype.update=function(){this.blocks=new ee(this),this.addChild(this.blocks),this.searchCircle=new ie(this),this.addChild(this.searchCircle),this.updateChilds()},e=gt([Tt({tag:"g",class:"stage",autoGenerate:!1}),mt("design:paramtypes",[Te])],e)}(Mt),re=function(t){function e(e){var n=t.call(this,e)||this;return n.parent=e,n.global.eventManager.addEventListener(Ct.RESIZE_WINDOW,function(t){n.node.attr("width",t.width).attr("height",t.height).on("click.zoomout",function(){n.global.eventManager.dispatch(Ct.CLICK_ZOOM_OUT,n)})}),n}return pt(e,t),e.prototype.update=function(){},e=gt([Tt({tag:"rect",class:"zoom-out-bg",autoGenerate:!1}),mt("design:paramtypes",[Te])],e)}(Mt),se=function(t){function e(e){var n=t.call(this,e)||this;return n.parent=e,n.attr("r",n.global.config.style.legend.radius),n.attr("fill",n.parent.legend_data.color),n}return pt(e,t),e.prototype.update=function(){},e=gt([Tt({tag:"circle",class:"legend-circle",autoGenerate:!1}),mt("design:paramtypes",[ue])],e)}(Mt),ae=function(t){function e(e){var n=t.call(this,e)||this;return n.parent=e,n.attr("x",1.5*n.global.config.style.legend.radius),n.attr("fill",n.global.config.style.legend.font_color),n.attr("font-size",n.global.config.style.legend.font_size),n}return pt(e,t),e.prototype.update=function(){},e=gt([Tt({tag:"text",class:"legend-title dark:fill-white",autoGenerate:!1}),mt("design:paramtypes",[ue])],e)}(Mt),le=function(t){function e(e){var n=t.call(this)||this;return n.x=e.x,n.y=e.y,n.title=e.title,n.color=e.color,n}return pt(e,t),e}(Bt),ue=function(t){function e(e,n){var i=t.call(this,e)||this;return i.parent=e,i.legend_data=n,i}return pt(e,t),e.prototype.update=function(){if(this.circle=new se(this),this.addChild(this.circle),this.title=new ae(this),this.addChild(this.title),this.updateChilds(),this.title.node.text(this.legend_data.title),this.child_index){var t=this.child_index*this.global.config.style.legend.padding;this.node.attr("transform","translate("+[0,t]+")")}},e=gt([Tt({tag:"g",class:"legend-item",autoGenerate:!1}),mt("design:paramtypes",[ce,le])],e)}(Mt),ce=function(t){function e(e){var n=t.call(this,e)||this;return n.parent=e,n}return pt(e,t),e.prototype.update=function(){var t=[];t.push({title:this.global.config.lang.non_selectable,color:this.global.config.style.seat.not_salable}),t.push({title:this.global.config.lang.selectable,color:this.global.config.style.seat.color}),t.push({title:this.global.config.lang.your_selection,color:this.global.config.style.seat.selected});for(var e=0;e<t.length;e++){var n=new ue(this,t[e]);this.addChild(n)}this.updateChilds()},e.prototype.afterGenerate=function(){var t=2*this.global.config.style.legend.radius,e=150-this.global.config.style.legend.padding*this.getChildCount();this.node.attr("transform","translate("+[t,e]+")")},e=gt([Tt({tag:"g",class:"legend",autoGenerate:!1}),mt("design:paramtypes",[Te])],e)}(Mt),he=Math.PI,fe=2*he,de=1e-6,pe=fe-de;function ge(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function me(){return new ge}function ve(t){return function(){return t}}function ye(t){this._context=t}function _e(t){return new ye(t)}function be(t){return t[0]}function we(t){return t[1]}ge.prototype=me.prototype={constructor:ge,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,i){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(t,e,n,i,o,r){this._+="C"+ +t+","+ +e+","+ +n+","+ +i+","+(this._x1=+o)+","+(this._y1=+r)},arcTo:function(t,e,n,i,o){t=+t,e=+e,n=+n,i=+i,o=+o;var r=this._x1,s=this._y1,a=n-t,l=i-e,u=r-t,c=s-e,h=u*u+c*c;if(o<0)throw new Error("negative radius: "+o);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(h>de)if(Math.abs(c*a-l*u)>de&&o){var f=n-r,d=i-s,p=a*a+l*l,g=f*f+d*d,m=Math.sqrt(p),v=Math.sqrt(h),y=o*Math.tan((he-Math.acos((p+h-g)/(2*m*v)))/2),_=y/v,b=y/m;Math.abs(_-1)>de&&(this._+="L"+(t+_*u)+","+(e+_*c)),this._+="A"+o+","+o+",0,0,"+ +(c*f>u*d)+","+(this._x1=t+b*a)+","+(this._y1=e+b*l)}else this._+="L"+(this._x1=t)+","+(this._y1=e);else;},arc:function(t,e,n,i,o,r){t=+t,e=+e,r=!!r;var s=(n=+n)*Math.cos(i),a=n*Math.sin(i),l=t+s,u=e+a,c=1^r,h=r?i-o:o-i;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+l+","+u:(Math.abs(this._x1-l)>de||Math.abs(this._y1-u)>de)&&(this._+="L"+l+","+u),n&&(h<0&&(h=h%fe+fe),h>pe?this._+="A"+n+","+n+",0,1,"+c+","+(t-s)+","+(e-a)+"A"+n+","+n+",0,1,"+c+","+(this._x1=l)+","+(this._y1=u):h>de&&(this._+="A"+n+","+n+",0,"+ +(h>=he)+","+c+","+(this._x1=t+n*Math.cos(o))+","+(this._y1=e+n*Math.sin(o))))},rect:function(t,e,n,i){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}},ye.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};var Ee,xe=function(t){function e(e){var n=t.call(this,e)||this;return n.parent=e,n.attr("width",n.global.config.style.tooltip.width),n.attr("height",n.global.config.style.tooltip.height),n.attr("x",0),n.attr("y",0),n.attr("rx",3),n.attr("ry",3),function(){var t=be,e=we,n=ve(!0),i=null,o=_e,r=null;function s(s){var a,l,u,c=s.length,h=!1;for(null==i&&(r=o(u=me())),a=0;a<=c;++a)!(a<c&&n(l=s[a],a,s))===h&&((h=!h)?r.lineStart():r.lineEnd()),h&&r.point(+t(l,a,s),+e(l,a,s));if(u)return r=null,u+""||null}return s.x=function(e){return arguments.length?(t="function"==typeof e?e:ve(+e),s):t},s.y=function(t){return arguments.length?(e="function"==typeof t?t:ve(+t),s):e},s.defined=function(t){return arguments.length?(n="function"==typeof t?t:ve(!!t),s):n},s.curve=function(t){return arguments.length?(o=t,null!=i&&(r=o(i)),s):o},s.context=function(t){return arguments.length?(null==t?i=r=null:r=o(i=t),s):i},s}().x(function(t){return t.x}).y(function(t){return t.y}),n.attr("fill",n.global.config.style.tooltip.bg),n.attr("stroke","rgba(0,0,0,0.3)"),n.attr("stroke-width","1px"),n.attr("opacity",.8),n}return pt(e,t),e.prototype.update=function(){return this.updateChilds(),this},e.prototype.afterGenerate=function(){this.node.style("pointer-events","none")},e=gt([Tt({tag:"rect",class:"tooltip-rect",autoGenerate:!1}),mt("design:paramtypes",[Me])],e)}(Mt),ke=function(t){function e(e){var n=t.call(this,e)||this;return n.parent=e,n.attr("x",6),n.attr("y",21),n.attr("fill",n.global.config.style.tooltip.color),n}return pt(e,t),e.prototype.update=function(){return this.updateChilds(),this},e.prototype.afterGenerate=function(){this.node.style("pointer-events","none"),this.node.style("font-size","12px")},e.prototype.generateTitle=function(){this.node.selectAll("tspan").remove().data(this.title).enter().append("tspan").text(function(t){return t}).attr("x",6).attr("y",function(t,e){return 16*e+16})},e=gt([Tt({tag:"text",class:"tooltip-title",autoGenerate:!1}),mt("design:paramtypes",[Me])],e)}(Mt),Me=function(t){function e(e){var n=t.call(this,e)||this;return n.parent=e,n.attr("transform","translate(0,0)"),n.attr("opacity",0),n.activeSeat=null,n.global.eventManager.addEventListener([Ct.MOUSEMOVE_SEAT],function(t){n.global.multi_select||n.activeSeat!==t&&t.item.title&&(n.activeSeat=t,n.setTitle(t.item.title.split("\n")),n.title.generateTitle())}),n.global.eventManager.addEventListener([Ct.MOUSEOUT_SEAT],function(t){n.node.attr("opacity",0),n.activeSeat=null,n.title.title=[],n.title.generateTitle()}),n.global.eventManager.addEventListener([Ct.TOUCHSTART_BLOCK],function(t){n.node.attr("opacity",0)}),n}return pt(e,t),e.prototype.setTitle=function(t){return this.title.title=t,this},e.prototype.update=function(){return this.rect=new xe(this).addTo(this),this.title=new ke(this).addTo(this),this.updateChilds(),this},e.prototype.afterGenerate=function(){var t=this;this.parent.node.on("mousemove.seat",function(){if(!t.global.multi_select)if(t.global.zoomManager.zoomLevel===St.SEAT&&null!==t.activeSeat){var e=ht(this),n=e[0]-t.global.config.style.tooltip.width/2,i=e[1]-(t.global.config.style.tooltip.height+t.global.config.style.seat.radius+2);t.node.attr("transform","translate("+[n,i]+")").attr("opacity",1)}else t.node.attr("opacity",0)})},e=gt([Tt({tag:"g",class:"seatmap-tooltip",autoGenerate:!1}),mt("design:paramtypes",[Te])],e)}(Mt),Te=function(t){function e(e){var n=t.call(this,e)||this;return n.parent=e,n.global.eventManager.addEventListener(Ct.ZOOM_LEVEL_CHANGE,function(t){n.node.classed("zoom-level-"+St.SEAT,!1),n.node.classed("zoom-level-"+St.BLOCK,!1),n.node.classed("zoom-level-"+St.VENUE,!1),n.node.classed("zoom-level-"+t.level,!0)}),n}return pt(e,t),e.prototype.update=function(){var t=this;this.stage=new oe(this).addToParent(),this.zoomOutBg=new re(this).addToParent(),this.global.config.legend&&(this.legend=new ce(this).addToParent()),this.tooltip=new Me(this).addToParent(),this.updateChilds(),this.stage.node.raise(),this.global.config.legend&&this.legend.node.raise(),this.tooltip.node.raise(),this.node.on("mousemove",function(){var e=ht(t.stage.node.node());t.parent.eventManager.dispatch(Ct.MOUSE_MOVE,e)})},e=gt([Tt({tag:"svg",class:"seatmap-svg",autoGenerate:!1}),mt("design:paramtypes",[to])],e)}(Mt),Le=function(){function t(t){this.context=t}return t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return console.log(t),this},t}();!function(t){t.SEATMAP="seatmap",t.PRETIX="pretix"}(Ee||(Ee={}));var ze=function(){function t(t){this._self=t,this.blocks=[],this.eventManager=t.eventManager,this.addEventListener=t.eventManager.addEventListener}return t.prototype.addBlock=function(t){return this.blocks.push(new Vt(t)),this.eventManager.dispatch(Ct.ADD_BLOCK,[t]),this.eventManager.dispatch(Ct.UPDATE_BLOCK,this.blocks),this},t.prototype.addBulkBlock=function(t){var e=this;if(this._self.config.json_model!==Ee.SEATMAP){var n=this._self.config.json_model;t=this._self.parsers[n].parse(t)}return t.map(function(t){e.blocks.push(new Vt(t))}),this.eventManager.dispatch(Ct.ADD_BLOCK,[t]),this.eventManager.dispatch(Ct.UPDATE_BLOCK,this.blocks),this},t.prototype.replaceData=function(t){return this.blocks=[],this.addBulkBlock(t),this},t.prototype.getBlock=function(t){var e=this.blocks.find(function(e){return e.id===t});return e||null},t.prototype.getBlocks=function(t){if(t){var e=this.getBlock(t);return e?[e]:[]}return this.blocks},t.prototype.removeBlock=function(t){var e=this;return this.filterBlock({id:t}).map(function(t,n){e.blocks.splice(n,1)}),this.eventManager.dispatch(Ct.REMOVE_BLOCK,t),this.eventManager.dispatch(Ct.UPDATE_BLOCK,this.blocks),this},t.prototype.getSeat=function(t,e){var n=this.getBlock(e);if(n){var i=n.seats.find(function(e){return e.id==t});return i||null}return console.error(new Error("Block not found!")),null},t.prototype.getSelectedSeats=function(t){var e=this.getBlocks(t),n=[];return e.forEach(function(t){t.seats.forEach(function(t){t.selected&&n.push(t)})}),n},t.prototype.filterBlock=function(t){return this.blocks.filter(function(e){return e.id===t.id})},t.prototype.toJson=function(){return{blocks:this.blocks}},t}(),Ce=function(){this.radius=12,this.color="#77b2ff",this.not_salable="#6293d2",this.selected="#4770ff",this.hover="#4770ff",this.focus="#6293d2",this.focus_out="#ff001c",this.check_color="#ffffff",this.check_icon="",this.check_icon_color="#ffffff",this.svg=null},Se=function(){this.fill="#ffffff",this.stroke="#ffffff",this.border_width=4,this.title_color="#000000",this.title_font_size=28},Ae=function(){this.radius=12,this.padding=36,this.font_size=12,this.font_color="#000"},Oe=function(){this.color="#000000",this.bg="#fff",this.font_size=12,this.radius=12},Be=function(){this.border_width=1,this.width=140,this.height=58,this.color="#000000",this.bg="#ffffff"},Ne=function(){},Ue=function(){function t(t){this.min_zoom=.1,this.max_zoom=1.9,this.animation_speed=600,this.resizable=!1,this.container=null,this.zoom_focus_circle_radius=60,this.click_enable_sold_seats=!1,this.legend=!1,this.canvas_stageout_control=!0,this.json_model=Ee.SEATMAP,this.json_model=t.json_model?t.json_model:Ee.SEATMAP,this.zoom_focus_circle_radius=t.zoom_focus_circle_radius?t.zoom_focus_circle_radius:this.zoom_focus_circle_radius,this.click_enable_sold_seats=t.click_enable_sold_seats?t.click_enable_sold_seats:this.click_enable_sold_seats,this.max_zoom=t.max_zoom?t.max_zoom:this.max_zoom,this.resizable=t.resizable?t.resizable:this.resizable,this.zoom_out_button=t.zoom_out_button?t.zoom_out_button:".zoom-out-button",this.legend=0!=t.legend||t.legend,this.canvas_stageout_control=0!=t.canvas_stageout_control||t.canvas_stageout_control,this.style=new Ne,this.style.seat=Object.assign(new Ce,t.style.seat),this.style.block=Object.assign(new Se,t.style.block),this.style.legend=Object.assign(new Ae,t.style.legend),this.style.label=Object.assign(new Oe,t.style.label),this.style.tooltip=Object.assign(new Be,t.style.tooltip),t.style,this.lang={selectable:t.lang&&t.lang.selectable||"Selectable",non_selectable:t.lang&&t.lang.non_selectable||"Non Selectable or Rezerved",your_selection:t.lang&&t.lang.your_selection||"Your Selection"}}return t.prototype.getAll=function(){return this},t}(),Ve={value:function(){}};function Ge(){for(var t,e=0,n=arguments.length,i={};e<n;++e){if(!(t=arguments[e]+"")||t in i||/[\s.]/.test(t))throw new Error("illegal type: "+t);i[t]=[]}return new Ie(i)}function Ie(t){this._=t}function Ke(t,e){for(var n,i=0,o=t.length;i<o;++i)if((n=t[i]).name===e)return n.value}function Pe(t,e,n){for(var i=0,o=t.length;i<o;++i)if(t[i].name===e){t[i]=Ve,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=n&&t.push({name:e,value:n}),t}function De(){$.preventDefault(),$.stopImmediatePropagation()}function je(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Re(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function Ze(){}Ie.prototype=Ge.prototype={constructor:Ie,on:function(t,e){var n,i,o=this._,r=(i=o,(t+"").trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!i.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}})),s=-1,a=r.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++s<a;)if(n=(t=r[s]).type)o[n]=Pe(o[n],t.name,e);else if(null==e)for(n in o)o[n]=Pe(o[n],t.name,null);return this}for(;++s<a;)if((n=(t=r[s]).type)&&(n=Ke(o[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Ie(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,i,o=new Array(n),r=0;r<n;++r)o[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(r=0,n=(i=this._[t]).length;r<n;++r)i[r].value.apply(e,o)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],o=0,r=i.length;o<r;++o)i[o].value.apply(e,n)}};var He=.7,Ye=1/He,qe="\\s*([+-]?\\d+)\\s*",Xe="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",We="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Fe=/^#([0-9a-f]{3,8})$/,$e=new RegExp("^rgb\\("+[qe,qe,qe]+"\\)$"),Je=new RegExp("^rgb\\("+[We,We,We]+"\\)$"),Qe=new RegExp("^rgba\\("+[qe,qe,qe,Xe]+"\\)$"),tn=new RegExp("^rgba\\("+[We,We,We,Xe]+"\\)$"),en=new RegExp("^hsl\\("+[Xe,We,We]+"\\)$"),nn=new RegExp("^hsla\\("+[Xe,We,We,Xe]+"\\)$"),on={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function rn(){return this.rgb().formatHex()}function sn(){return this.rgb().formatRgb()}function an(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Fe.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?ln(e):3===n?new hn(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?un(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?un(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=$e.exec(t))?new hn(e[1],e[2],e[3],1):(e=Je.exec(t))?new hn(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Qe.exec(t))?un(e[1],e[2],e[3],e[4]):(e=tn.exec(t))?un(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=en.exec(t))?gn(e[1],e[2]/100,e[3]/100,1):(e=nn.exec(t))?gn(e[1],e[2]/100,e[3]/100,e[4]):on.hasOwnProperty(t)?ln(on[t]):"transparent"===t?new hn(NaN,NaN,NaN,0):null}function ln(t){return new hn(t>>16&255,t>>8&255,255&t,1)}function un(t,e,n,i){return i<=0&&(t=e=n=NaN),new hn(t,e,n,i)}function cn(t,e,n,i){return 1===arguments.length?((o=t)instanceof Ze||(o=an(o)),o?new hn((o=o.rgb()).r,o.g,o.b,o.opacity):new hn):new hn(t,e,n,null==i?1:i);var o}function hn(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}function fn(){return"#"+pn(this.r)+pn(this.g)+pn(this.b)}function dn(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function pn(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function gn(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new vn(t,e,n,i)}function mn(t){if(t instanceof vn)return new vn(t.h,t.s,t.l,t.opacity);if(t instanceof Ze||(t=an(t)),!t)return new vn;if(t instanceof vn)return t;var e=(t=t.rgb()).r/255,n=t.g/255,i=t.b/255,o=Math.min(e,n,i),r=Math.max(e,n,i),s=NaN,a=r-o,l=(r+o)/2;return a?(s=e===r?(n-i)/a+6*(n<i):n===r?(i-e)/a+2:(e-n)/a+4,a/=l<.5?r+o:2-r-o,s*=60):a=l>0&&l<1?0:s,new vn(s,a,l,t.opacity)}function vn(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function yn(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function _n(t){return function(){return t}}function bn(t){return 1===(t=+t)?wn:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}(e,n,t):_n(isNaN(e)?n:e)}}function wn(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):_n(isNaN(t)?e:t)}je(Ze,an,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:rn,formatHex:rn,formatHsl:function(){return mn(this).formatHsl()},formatRgb:sn,toString:sn}),je(hn,cn,Re(Ze,{brighter:function(t){return t=null==t?Ye:Math.pow(Ye,t),new hn(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?He:Math.pow(He,t),new hn(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:fn,formatHex:fn,formatRgb:dn,toString:dn})),je(vn,function(t,e,n,i){return 1===arguments.length?mn(t):new vn(t,e,n,null==i?1:i)},Re(Ze,{brighter:function(t){return t=null==t?Ye:Math.pow(Ye,t),new vn(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?He:Math.pow(He,t),new vn(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,o=2*n-i;return new hn(yn(t>=240?t-240:t+120,o,i),yn(t,o,i),yn(t<120?t+240:t-120,o,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var En=function t(e){var n=bn(e);function i(t,e){var i=n((t=cn(t)).r,(e=cn(e)).r),o=n(t.g,e.g),r=n(t.b,e.b),s=wn(t.opacity,e.opacity);return function(e){return t.r=i(e),t.g=o(e),t.b=r(e),t.opacity=s(e),t+""}}return i.gamma=t,i}(1);function xn(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var kn=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Mn=new RegExp(kn.source,"g");function Tn(t,e){var n,i,o,r=kn.lastIndex=Mn.lastIndex=0,s=-1,a=[],l=[];for(t+="",e+="";(n=kn.exec(t))&&(i=Mn.exec(e));)(o=i.index)>r&&(o=e.slice(r,o),a[s]?a[s]+=o:a[++s]=o),(n=n[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,l.push({i:s,x:xn(n,i)})),r=Mn.lastIndex;return r<e.length&&(o=e.slice(r),a[s]?a[s]+=o:a[++s]=o),a.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var n,i=0;i<e;++i)a[(n=l[i]).i]=n.x(t);return a.join("")})}var Ln,zn,Cn,Sn,An=180/Math.PI,On={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Bn(t,e,n,i,o,r){var s,a,l;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(l=t*n+e*i)&&(n-=t*l,i-=e*l),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,l/=a),t*i<e*n&&(t=-t,e=-e,l=-l,s=-s),{translateX:o,translateY:r,rotate:Math.atan2(e,t)*An,skewX:Math.atan(l)*An,scaleX:s,scaleY:a}}function Nn(t,e,n,i){function o(t){return t.length?t.pop()+" ":""}return function(r,s){var a=[],l=[];return r=t(r),s=t(s),function(t,i,o,r,s,a){if(t!==o||i!==r){var l=s.push("translate(",null,e,null,n);a.push({i:l-4,x:xn(t,o)},{i:l-2,x:xn(i,r)})}else(o||r)&&s.push("translate("+o+e+r+n)}(r.translateX,r.translateY,s.translateX,s.translateY,a,l),function(t,e,n,r){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),r.push({i:n.push(o(n)+"rotate(",null,i)-2,x:xn(t,e)})):e&&n.push(o(n)+"rotate("+e+i)}(r.rotate,s.rotate,a,l),function(t,e,n,r){t!==e?r.push({i:n.push(o(n)+"skewX(",null,i)-2,x:xn(t,e)}):e&&n.push(o(n)+"skewX("+e+i)}(r.skewX,s.skewX,a,l),function(t,e,n,i,r,s){if(t!==n||e!==i){var a=r.push(o(r)+"scale(",null,",",null,")");s.push({i:a-4,x:xn(t,n)},{i:a-2,x:xn(e,i)})}else 1===n&&1===i||r.push(o(r)+"scale("+n+","+i+")")}(r.scaleX,r.scaleY,s.scaleX,s.scaleY,a,l),r=s=null,function(t){for(var e,n=-1,i=l.length;++n<i;)a[(e=l[n]).i]=e.x(t);return a.join("")}}}var Un=Nn(function(t){return"none"===t?On:(Ln||(Ln=document.createElement("DIV"),zn=document.documentElement,Cn=document.defaultView),Ln.style.transform=t,t=Cn.getComputedStyle(zn.appendChild(Ln),null).getPropertyValue("transform"),zn.removeChild(Ln),Bn(+(t=t.slice(7,-1).split(","))[0],+t[1],+t[2],+t[3],+t[4],+t[5]))},"px, ","px)","deg)"),Vn=Nn(function(t){return null==t?On:(Sn||(Sn=document.createElementNS("http://www.w3.org/2000/svg","g")),Sn.setAttribute("transform",t),(t=Sn.transform.baseVal.consolidate())?Bn((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):On)},", ",")",")"),Gn=Math.SQRT2;function In(t){return((t=Math.exp(t))+1/t)/2}function Kn(t,e){var n,i,o=t[0],r=t[1],s=t[2],a=e[0],l=e[1],u=e[2],c=a-o,h=l-r,f=c*c+h*h;if(f<1e-12)i=Math.log(u/s)/Gn,n=function(t){return[o+t*c,r+t*h,s*Math.exp(Gn*t*i)]};else{var d=Math.sqrt(f),p=(u*u-s*s+4*f)/(2*s*2*d),g=(u*u-s*s-4*f)/(2*u*2*d),m=Math.log(Math.sqrt(p*p+1)-p),v=Math.log(Math.sqrt(g*g+1)-g);i=(v-m)/Gn,n=function(t){var e=t*i,n=In(m),a=s/(2*d)*(n*function(t){return((t=Math.exp(2*t))-1)/(t+1)}(Gn*e+m)-function(t){return((t=Math.exp(t))-1/t)/2}(m));return[o+a*c,r+a*h,s*n/In(Gn*e+m)]}}return n.duration=1e3*i,n}var Pn,Dn,jn=0,Rn=0,Zn=0,Hn=0,Yn=0,qn=0,Xn="object"==typeof performance&&performance.now?performance:Date,Wn="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Fn(){return Yn||(Wn($n),Yn=Xn.now()+qn)}function $n(){Yn=0}function Jn(){this._call=this._time=this._next=null}function Qn(t,e,n){var i=new Jn;return i.restart(t,e,n),i}function ti(){Yn=(Hn=Xn.now())+qn,jn=Rn=0;try{!function(){Fn(),++jn;for(var t,e=Pn;e;)(t=Yn-e._time)>=0&&e._call.call(null,t),e=e._next;--jn}()}finally{jn=0,function(){var t,e,n=Pn,i=1/0;for(;n;)n._call?(i>n._time&&(i=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:Pn=e);Dn=t,ni(i)}(),Yn=0}}function ei(){var t=Xn.now(),e=t-Hn;e>1e3&&(qn-=e,Hn=t)}function ni(t){jn||(Rn&&(Rn=clearTimeout(Rn)),t-Yn>24?(t<1/0&&(Rn=setTimeout(ti,t-Xn.now()-qn)),Zn&&(Zn=clearInterval(Zn))):(Zn||(Hn=Xn.now(),Zn=setInterval(ei,1e3)),jn=1,Wn(ti)))}function ii(t,e,n){var i=new Jn;return e=null==e?0:+e,i.restart(function(n){i.stop(),t(n+e)},e,n),i}Jn.prototype=Qn.prototype={constructor:Jn,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?Fn():+n)+(null==e?0:+e),this._next||Dn===this||(Dn?Dn._next=this:Pn=this,Dn=this),this._call=t,this._time=n,ni()},stop:function(){this._call&&(this._call=null,this._time=1/0,ni())}};var oi=Ge("start","end","cancel","interrupt"),ri=[];function si(t,e,n,i,o,r){var s=t.__transition;if(s){if(n in s)return}else t.__transition={};!function(t,e,n){var i,o=t.__transition;function r(t){n.state=1,n.timer.restart(s,n.delay,n.time),n.delay<=t&&s(t-n.delay)}function s(r){var u,c,h,f;if(1!==n.state)return l();for(u in o)if((f=o[u]).name===n.name){if(3===f.state)return ii(s);4===f.state?(f.state=6,f.timer.stop(),f.on.call("interrupt",t,t.__data__,f.index,f.group),delete o[u]):+u<e&&(f.state=6,f.timer.stop(),f.on.call("cancel",t,t.__data__,f.index,f.group),delete o[u])}if(ii(function(){3===n.state&&(n.state=4,n.timer.restart(a,n.delay,n.time),a(r))}),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,i=new Array(h=n.tween.length),u=0,c=-1;u<h;++u)(f=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(i[++c]=f);i.length=c+1}}function a(e){for(var o=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(l),n.state=5,1),r=-1,s=i.length;++r<s;)i[r].call(t,o);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),l())}function l(){for(var i in n.state=6,n.timer.stop(),delete o[e],o)return;delete t.__transition}o[e]=n,n.timer=Qn(r,0,n.time)}(t,n,{name:e,index:i,group:o,on:oi,tween:ri,time:r.time,delay:r.delay,duration:r.duration,ease:r.ease,timer:null,state:0})}function ai(t,e){var n=ui(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function li(t,e){var n=ui(t,e);if(n.state>3)throw new Error("too late; already running");return n}function ui(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function ci(t,e){var n,i,o,r=t.__transition,s=!0;if(r){for(o in e=null==e?null:e+"",r)(n=r[o]).name===e?(i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete r[o]):s=!1;s&&delete t.__transition}}function hi(t,e){var n,i;return function(){var o=li(this,t),r=o.tween;if(r!==n)for(var s=0,a=(i=n=r).length;s<a;++s)if(i[s].name===e){(i=i.slice()).splice(s,1);break}o.tween=i}}function fi(t,e,n){var i,o;if("function"!=typeof n)throw new Error;return function(){var r=li(this,t),s=r.tween;if(s!==i){o=(i=s).slice();for(var a={name:e,value:n},l=0,u=o.length;l<u;++l)if(o[l].name===e){o[l]=a;break}l===u&&o.push(a)}r.tween=o}}function di(t,e,n){var i=t._id;return t.each(function(){var t=li(this,i);(t.value||(t.value={}))[e]=n.apply(this,arguments)}),function(t){return ui(t,i).value[e]}}function pi(t,e){var n;return("number"==typeof e?xn:e instanceof an?En:(n=an(e))?(e=n,En):Tn)(t,e)}function gi(t){return function(){this.removeAttribute(t)}}function mi(t){return function(){this.removeAttributeNS(t.space,t.local)}}function vi(t,e,n){var i,o,r=n+"";return function(){var s=this.getAttribute(t);return s===r?null:s===i?o:o=e(i=s,n)}}function yi(t,e,n){var i,o,r=n+"";return function(){var s=this.getAttributeNS(t.space,t.local);return s===r?null:s===i?o:o=e(i=s,n)}}function _i(t,e,n){var i,o,r;return function(){var s,a,l=n(this);if(null!=l)return(s=this.getAttribute(t))===(a=l+"")?null:s===i&&a===o?r:(o=a,r=e(i=s,l));this.removeAttribute(t)}}function bi(t,e,n){var i,o,r;return function(){var s,a,l=n(this);if(null!=l)return(s=this.getAttributeNS(t.space,t.local))===(a=l+"")?null:s===i&&a===o?r:(o=a,r=e(i=s,l));this.removeAttributeNS(t.space,t.local)}}function wi(t,e){var n,i;function o(){var o=e.apply(this,arguments);return o!==i&&(n=(i=o)&&function(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}(t,o)),n}return o._value=e,o}function Ei(t,e){var n,i;function o(){var o=e.apply(this,arguments);return o!==i&&(n=(i=o)&&function(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}(t,o)),n}return o._value=e,o}function xi(t,e){return function(){ai(this,t).delay=+e.apply(this,arguments)}}function ki(t,e){return e=+e,function(){ai(this,t).delay=e}}function Mi(t,e){return function(){li(this,t).duration=+e.apply(this,arguments)}}function Ti(t,e){return e=+e,function(){li(this,t).duration=e}}var Li=at.prototype.constructor;function zi(t){return function(){this.style.removeProperty(t)}}var Ci=0;function Si(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function Ai(){return++Ci}var Oi=at.prototype;Si.prototype={constructor:Si,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=a(t));for(var i=this._groups,o=i.length,r=new Array(o),s=0;s<o;++s)for(var l,u,c=i[s],h=c.length,f=r[s]=new Array(h),d=0;d<h;++d)(l=c[d])&&(u=t.call(l,l.__data__,d,c))&&("__data__"in l&&(u.__data__=l.__data__),f[d]=u,si(f[d],e,n,d,f,ui(l,n)));return new Si(r,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=u(t));for(var i=this._groups,o=i.length,r=[],s=[],a=0;a<o;++a)for(var l,c=i[a],h=c.length,f=0;f<h;++f)if(l=c[f]){for(var d,p=t.call(l,l.__data__,f,c),g=ui(l,n),m=0,v=p.length;m<v;++m)(d=p[m])&&si(d,e,n,m,p,g);r.push(p),s.push(l)}return new Si(r,s,e,n)},filter:function(t){"function"!=typeof t&&(t=c(t));for(var e=this._groups,n=e.length,i=new Array(n),o=0;o<n;++o)for(var r,s=e[o],a=s.length,l=i[o]=[],u=0;u<a;++u)(r=s[u])&&t.call(r,r.__data__,u,s)&&l.push(r);return new Si(i,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,o=n.length,r=Math.min(i,o),s=new Array(i),a=0;a<r;++a)for(var l,u=e[a],c=n[a],h=u.length,f=s[a]=new Array(h),d=0;d<h;++d)(l=u[d]||c[d])&&(f[d]=l);for(;a<i;++a)s[a]=e[a];return new Si(s,this._parents,this._name,this._id)},selection:function(){return new Li(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=Ai(),i=this._groups,o=i.length,r=0;r<o;++r)for(var s,a=i[r],l=a.length,u=0;u<l;++u)if(s=a[u]){var c=ui(s,e);si(s,t,n,u,a,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new Si(i,this._parents,t,n)},call:Oi.call,nodes:Oi.nodes,node:Oi.node,size:Oi.size,empty:Oi.empty,each:Oi.each,on:function(t,e){var n=this._id;return arguments.length<2?ui(this.node(),n).on.on(t):this.each(function(t,e,n){var i,o,r=function(t){return(t+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t})}(e)?ai:li;return function(){var s=r(this,t),a=s.on;a!==i&&(o=(i=a).copy()).on(e,n),s.on=o}}(n,t,e))},attr:function(t,e){var i=n(t),o="transform"===i?Vn:pi;return this.attrTween(t,"function"==typeof e?(i.local?bi:_i)(i,o,di(this,"attr."+t,e)):null==e?(i.local?mi:gi)(i):(i.local?yi:vi)(i,o,e))},attrTween:function(t,e){var i="attr."+t;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw new Error;var o=n(t);return this.tween(i,(o.local?wi:Ei)(o,e))},style:function(t,e,n){var i="transform"==(t+="")?Un:pi;return null==e?this.styleTween(t,function(t,e){var n,i,o;return function(){var r=T(this,t),s=(this.style.removeProperty(t),T(this,t));return r===s?null:r===n&&s===i?o:o=e(n=r,i=s)}}(t,i)).on("end.style."+t,zi(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var i,o,r;return function(){var s=T(this,t),a=n(this),l=a+"";return null==a&&(this.style.removeProperty(t),l=a=T(this,t)),s===l?null:s===i&&l===o?r:(o=l,r=e(i=s,a))}}(t,i,di(this,"style."+t,e))).each(function(t,e){var n,i,o,r,s="style."+e,a="end."+s;return function(){var l=li(this,t),u=l.on,c=null==l.value[s]?r||(r=zi(e)):void 0;u===n&&o===c||(i=(n=u).copy()).on(a,o=c),l.on=i}}(this._id,t)):this.styleTween(t,function(t,e,n){var i,o,r=n+"";return function(){var s=T(this,t);return s===r?null:s===i?o:o=e(i=s,n)}}(t,i,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw new Error;return this.tween(i,function(t,e,n){var i,o;function r(){var r=e.apply(this,arguments);return r!==o&&(i=(o=r)&&function(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}(t,r,n)),i}return r._value=e,r}(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(di(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,function(t){var e,n;function i(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&function(t){return function(e){this.textContent=t.call(this,e)}}(i)),e}return i._value=t,i}(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i,o=ui(this.node(),n).tween,r=0,s=o.length;r<s;++r)if((i=o[r]).name===t)return i.value;return null}return this.each((null==e?hi:fi)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?xi:ki)(e,t)):ui(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?Mi:Ti)(e,t)):ui(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){li(this,t).ease=e}}(e,t)):ui(this.node(),e).ease},end:function(){var t,e,n=this,i=n._id,o=n.size();return new Promise(function(r,s){var a={value:s},l={value:function(){0===--o&&r()}};n.each(function(){var n=li(this,i),o=n.on;o!==t&&((e=(t=o).copy())._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),n.on=e})})}};var Bi={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function Ni(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))return Bi.time=Fn(),Bi;return n}function Ui(t){return function(){return t}}function Vi(t,e,n){this.target=t,this.type=e,this.transform=n}function Gi(t,e,n){this.k=t,this.x=e,this.y=n}at.prototype.interrupt=function(t){return this.each(function(){ci(this,t)})},at.prototype.transition=function(t){var e,n;t instanceof Si?(e=t._id,t=t._name):(e=Ai(),(n=Bi).time=Fn(),t=null==t?null:t+"");for(var i=this._groups,o=i.length,r=0;r<o;++r)for(var s,a=i[r],l=a.length,u=0;u<l;++u)(s=a[u])&&si(s,t,e,u,a,n||Ni(s,e));return new Si(i,this._parents,t,e)},Gi.prototype={constructor:Gi,scale:function(t){return 1===t?this:new Gi(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new Gi(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Ii=new Gi(1,0,0);function Ki(){$.stopImmediatePropagation()}function Pi(){$.preventDefault(),$.stopImmediatePropagation()}function Di(){return!$.ctrlKey&&!$.button}function ji(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function Ri(){return this.__zoom||Ii}function Zi(){return-$.deltaY*(1===$.deltaMode?.05:$.deltaMode?1:.002)}function Hi(){return navigator.maxTouchPoints||"ontouchstart"in this}function Yi(t,e,n){var i=t.invertX(e[0][0])-n[0][0],o=t.invertX(e[1][0])-n[1][0],r=t.invertY(e[0][1])-n[0][1],s=t.invertY(e[1][1])-n[1][1];return t.translate(o>i?(i+o)/2:Math.min(0,i)||Math.max(0,o),s>r?(r+s)/2:Math.min(0,r)||Math.max(0,s))}function qi(){var t,e,n=Di,i=ji,o=Yi,r=Zi,s=Hi,a=[0,1/0],l=[[-1/0,-1/0],[1/0,1/0]],u=250,c=Kn,h=Ge("start","zoom","end"),f=0;function d(t){t.property("__zoom",Ri).on("wheel.zoom",b).on("mousedown.zoom",w).on("dblclick.zoom",E).filter(s).on("touchstart.zoom",x).on("touchmove.zoom",k).on("touchend.zoom touchcancel.zoom",M).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(t,e){return(e=Math.max(a[0],Math.min(a[1],e)))===t.k?t:new Gi(e,t.x,t.y)}function g(t,e,n){var i=e[0]-n[0]*t.k,o=e[1]-n[1]*t.k;return i===t.x&&o===t.y?t:new Gi(t.k,i,o)}function m(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function v(t,e,n){t.on("start.zoom",function(){y(this,arguments).start()}).on("interrupt.zoom end.zoom",function(){y(this,arguments).end()}).tween("zoom",function(){var t=this,o=arguments,r=y(t,o),s=i.apply(t,o),a=null==n?m(s):"function"==typeof n?n.apply(t,o):n,l=Math.max(s[1][0]-s[0][0],s[1][1]-s[0][1]),u=t.__zoom,h="function"==typeof e?e.apply(t,o):e,f=c(u.invert(a).concat(l/u.k),h.invert(a).concat(l/h.k));return function(t){if(1===t)t=h;else{var e=f(t),n=l/e[2];t=new Gi(n,a[0]-e[0]*n,a[1]-e[1]*n)}r.zoom(null,t)}})}function y(t,e,n){return!n&&t.__zooming||new _(t,e)}function _(t,e){this.that=t,this.args=e,this.active=0,this.extent=i.apply(t,e),this.taps=0}function b(){if(n.apply(this,arguments)){var t=y(this,arguments),e=this.__zoom,i=Math.max(a[0],Math.min(a[1],e.k*Math.pow(2,r.apply(this,arguments)))),s=ht(this);if(t.wheel)t.mouse[0][0]===s[0]&&t.mouse[0][1]===s[1]||(t.mouse[1]=e.invert(t.mouse[0]=s)),clearTimeout(t.wheel);else{if(e.k===i)return;t.mouse=[s,e.invert(s)],ci(this),t.start()}Pi(),t.wheel=setTimeout(function(){t.wheel=null,t.end()},150),t.zoom("mouse",o(g(p(e,i),t.mouse[0],t.mouse[1]),t.extent,l))}}function w(){if(!e&&n.apply(this,arguments)){var t=y(this,arguments,!0),i=lt($.view).on("mousemove.zoom",function(){if(Pi(),!t.moved){var e=$.clientX-s,n=$.clientY-a;t.moved=e*e+n*n>f}t.zoom("mouse",o(g(t.that.__zoom,t.mouse[0]=ht(t.that),t.mouse[1]),t.extent,l))},!0).on("mouseup.zoom",function(){i.on("mousemove.zoom mouseup.zoom",null),function(t,e){var n=t.document.documentElement,i=lt(t).on("dragstart.drag",null);e&&(i.on("click.drag",De,!0),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}($.view,t.moved),Pi(),t.end()},!0),r=ht(this),s=$.clientX,a=$.clientY;!function(t){var e=t.document.documentElement,n=lt(t).on("dragstart.drag",De,!0);"onselectstart"in e?n.on("selectstart.drag",De,!0):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}($.view),Ki(),t.mouse=[r,this.__zoom.invert(r)],ci(this),t.start()}}function E(){if(n.apply(this,arguments)){var t=this.__zoom,e=ht(this),r=t.invert(e),s=t.k*($.shiftKey?.5:2),a=o(g(p(t,s),e,r),i.apply(this,arguments),l);Pi(),u>0?lt(this).transition().duration(u).call(v,a,e):lt(this).call(d.transform,a)}}function x(){if(n.apply(this,arguments)){var e,i,o,r,s=$.touches,a=s.length,l=y(this,arguments,$.changedTouches.length===a);for(Ki(),i=0;i<a;++i)r=[r=ft(this,s,(o=s[i]).identifier),this.__zoom.invert(r),o.identifier],l.touch0?l.touch1||l.touch0[2]===r[2]||(l.touch1=r,l.taps=0):(l.touch0=r,e=!0,l.taps=1+!!t);t&&(t=clearTimeout(t)),e&&(l.taps<2&&(t=setTimeout(function(){t=null},500)),ci(this),l.start())}}function k(){if(this.__zooming){var e,n,i,r,s=y(this,arguments),a=$.changedTouches,u=a.length;for(Pi(),t&&(t=clearTimeout(t)),s.taps=0,e=0;e<u;++e)i=ft(this,a,(n=a[e]).identifier),s.touch0&&s.touch0[2]===n.identifier?s.touch0[0]=i:s.touch1&&s.touch1[2]===n.identifier&&(s.touch1[0]=i);if(n=s.that.__zoom,s.touch1){var c=s.touch0[0],h=s.touch0[1],f=s.touch1[0],d=s.touch1[1],m=(m=f[0]-c[0])*m+(m=f[1]-c[1])*m,v=(v=d[0]-h[0])*v+(v=d[1]-h[1])*v;n=p(n,Math.sqrt(m/v)),i=[(c[0]+f[0])/2,(c[1]+f[1])/2],r=[(h[0]+d[0])/2,(h[1]+d[1])/2]}else{if(!s.touch0)return;i=s.touch0[0],r=s.touch0[1]}s.zoom("touch",o(g(n,i,r),s.extent,l))}}function M(){if(this.__zooming){var t,n,i=y(this,arguments),o=$.changedTouches,r=o.length;for(Ki(),e&&clearTimeout(e),e=setTimeout(function(){e=null},500),t=0;t<r;++t)n=o[t],i.touch0&&i.touch0[2]===n.identifier?delete i.touch0:i.touch1&&i.touch1[2]===n.identifier&&delete i.touch1;if(i.touch1&&!i.touch0&&(i.touch0=i.touch1,delete i.touch1),i.touch0)i.touch0[1]=this.__zoom.invert(i.touch0[0]);else if(i.end(),2===i.taps){var s=lt(this).on("dblclick.zoom");s&&s.apply(this,arguments)}}}return d.transform=function(t,e,n){var i=t.selection?t.selection():t;i.property("__zoom",Ri),t!==i?v(t,e,n):i.interrupt().each(function(){y(this,arguments).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()})},d.scaleBy=function(t,e,n){d.scaleTo(t,function(){return this.__zoom.k*("function"==typeof e?e.apply(this,arguments):e)},n)},d.scaleTo=function(t,e,n){d.transform(t,function(){var t=i.apply(this,arguments),r=this.__zoom,s=null==n?m(t):"function"==typeof n?n.apply(this,arguments):n,a=r.invert(s),u="function"==typeof e?e.apply(this,arguments):e;return o(g(p(r,u),s,a),t,l)},n)},d.translateBy=function(t,e,n){d.transform(t,function(){return o(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),i.apply(this,arguments),l)})},d.translateTo=function(t,e,n,r){d.transform(t,function(){var t=i.apply(this,arguments),s=this.__zoom,a=null==r?m(t):"function"==typeof r?r.apply(this,arguments):r;return o(Ii.translate(a[0],a[1]).scale(s.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof n?-n.apply(this,arguments):-n),t,l)},r)},_.prototype={start:function(){return 1===++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0===--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){!function(t,e,n,i){var o=$;t.sourceEvent=$,$=t;try{return e.apply(n,i)}finally{$=o}}(new Vi(d,t,this.that.__zoom),h.apply,h,[t,this.that,this.args])}},d.wheelDelta=function(t){return arguments.length?(r="function"==typeof t?t:Ui(+t),d):r},d.filter=function(t){return arguments.length?(n="function"==typeof t?t:Ui(!!t),d):n},d.touchable=function(t){return arguments.length?(s="function"==typeof t?t:Ui(!!t),d):s},d.extent=function(t){return arguments.length?(i="function"==typeof t?t:Ui([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),d):i},d.scaleExtent=function(t){return arguments.length?(a[0]=+t[0],a[1]=+t[1],d):[a[0],a[1]]},d.translateExtent=function(t){return arguments.length?(l[0][0]=+t[0][0],l[1][0]=+t[1][0],l[0][1]=+t[0][1],l[1][1]=+t[1][1],d):[[l[0][0],l[0][1]],[l[1][0],l[1][1]]]},d.constrain=function(t){return arguments.length?(o=t,d):o},d.duration=function(t){return arguments.length?(u=+t,d):u},d.interpolate=function(t){return arguments.length?(c=t,d):c},d.on=function(){var t=h.on.apply(h,arguments);return t===h?d:t},d.clickDistance=function(t){return arguments.length?(f=(t=+t)*t,d):Math.sqrt(f)},d}Gi.prototype;var Xi=function(){function t(t){this._self=t,this.zoomTypes={normal:null,animated:null,fastAnimated:null},this.scale={x:null,y:null,k:null},this.zoomLevels={VENUE:null,BLOCK:null,SEAT:null},this.minZoom=null,this.activeBlocks=[],this.zoomLevel=St.VENUE,this.dispatchZoomEvent()}return t.prototype.init=function(){var t=this;console.log("zoom init"),this.calculateZoomLevels(),this.zoomInit(),this._self.eventManager.addEventListener(Ct.KEYDOWN_SVG,function(e){17!=e.which&&91!==e.which||(t._self.eventManager.dispatch(Ct.MULTI_SELECT_ENABLE,e),$.preventDefault(),t.zoomDisable())}),this._self.eventManager.addEventListener(Ct.KEYUP_SVG,function(e){t._self.eventManager.dispatch(Ct.MULTI_SELECT_DISABLE,e),$.preventDefault(),t.zoomEnable()})},t.prototype.zoomInit=function(){console.info("zoomInit"),this.zoomTypes.normal=qi().scaleExtent([this._self.config.min_zoom,this._self.config.max_zoom]).on("end",this.zoomEnd(this)).on("zoom",this.zoomHand(this)),this.zoomTypes.animated=qi().scaleExtent([this._self.config.min_zoom,this._self.config.max_zoom]).on("end",this.animatedZoomEnd(this)).on("zoom",this.zoomHandAnimated(this)),this.zoomTypes.fastAnimated=qi().scaleExtent([this._self.config.min_zoom,this._self.config.max_zoom]).on("end",this.animatedFastZoomEnd(this)).on("zoom",this.zoomHandFastAnimated(this)),this._self.svg.node.call(this.zoomTypes.normal),this._self.svg.node.on("dblclick.zoom",null)},t.prototype.zoomEnd=function(t){return console.info("zoomEnd"),function(){var e=$.transform.x,n=$.transform.y,i=$.transform.k;t._self.svg.stage.node.interrupt().attr("transform","translate("+e+","+n+")scale("+i+")"),t.calculateActiveBlocks(),t.calculateZoomLevel(i)}},t.prototype.animatedZoomEnd=function(t){return console.info("animatedZoomEnd"),function(){var e=$.transform.x,n=$.transform.y,i=$.transform.k;t._self.svg.stage.node.interrupt().transition().duration(t._self.config.animation_speed).attr("transform","translate("+e+","+n+")scale("+i+")"),t.calculateActiveBlocks(),t.calculateZoomLevel(i)}},t.prototype.animatedFastZoomEnd=function(t){return console.info("animatedFastZoomEnd"),function(){var e=$.transform.x,n=$.transform.y,i=$.transform.k;t._self.svg.stage.node.interrupt().transition().duration(t._self.config.animation_speed/2).attr("transform","translate("+e+","+n+")scale("+i+")"),t.calculateActiveBlocks(),t.calculateZoomLevel(i)}},t.prototype.zoomHand=function(t){return console.info("zoomHand"),function(){var e=$.transform.x,n=$.transform.y,i=$.transform.k;t._self.svg.stage.node.interrupt().attr("transform","translate("+e+","+n+")scale("+i+")"),t.calculateZoomLevel(i)}},t.prototype.zoomHandAnimated=function(t){return console.info("zoomHandAnimated"),function(){var e=$.transform.x,n=$.transform.y,i=$.transform.k;t._self.svg.stage.node.interrupt().transition().duration(t._self.config.animation_speed).attr("transform","translate("+e+","+n+")scale("+i+")")}},t.prototype.zoomHandFastAnimated=function(t){return console.info("zoomHandFastAnimated"),function(){var e=$.transform.x,n=$.transform.y,i=$.transform.k;t._self.svg.stage.node.interrupt().transition().duration(t._self.config.animation_speed/2).attr("transform","translate("+e+","+n+")scale("+i+")")}},t.prototype.calculateZoomLevel=function(t){var e,n;if((null===(e=this.zoomLevels.BLOCK)||void 0===e?void 0:e.k)&&(null===(n=this.zoomLevels.VENUE)||void 0===n?void 0:n.k)){var i=this._self.config.max_zoom-.2,o=this.zoomLevels.BLOCK.k,r=this.zoomLevels.VENUE.k,s=null,a=this._self.data.getBlocks().length;t>=i?s=St.SEAT:t>=o?s=St.BLOCK:t>=r&&a>1&&(s=St.VENUE),s!==this.zoomLevel&&(this.zoomLevel=s,this.dispatchZoomEvent())}},t.prototype.canvasScopeHandler=function(){if(!1!==this._self.config.canvas_stageout_control){var t=this._self.svg.stage.blocks.node.node().getBoundingClientRect(),e=this._self.svg.node.node().getBoundingClientRect();(this.zoomLevel===St.VENUE||this.zoomLevel===St.BLOCK&&1===this._self.data.getBlocks().length||this.zoomLevel==St.SEAT&&this.zoomLevels.BLOCK&&this.zoomLevels.BLOCK.k===this._self.config.max_zoom)&&(t.left<e.left||t.top<e.top||t.right>e.right||t.bottom>e.bottom)&&this.zoomToVenue(!0,!0)}},t.prototype.calculateZoomLevels=function(t){void 0===t&&(t=this._self.data.getBlocks());var e=this._self.windowManager,n=e.stage;t.map(function(t){t.seats.map(function(e){e.x<t.x&&(t.x=e.x),e.y<t.y&&(t.y=e.y),e.x>n.width&&(n.width=e.x),e.y>n.height&&(n.height=e.y)}),t.labels.map(function(e){e.x<t.x&&(t.x=e.x),e.y<t.y&&(t.y=e.y),e.x>n.width&&(n.width=e.x),e.y>n.height&&(n.height=e.y)})}),e.width&&e.height&&(this.scale.x=e.width/n.width-e.width/n.width/5,this.scale.y=e.height/n.height-e.height/n.height/5),this.scale.k=this.scale.x<this.scale.y?this.scale.x:this.scale.y,this.minZoom=this.scale.k<1?this.scale.k:1,this.scale.k=this.scale.k>this._self.config.max_zoom?this._self.config.max_zoom:this.scale.k;var i=n.width/2,o=n.height/2;return this.zoomLevels.VENUE={x:i,y:o,k:this.scale.k-.01},1===this._self.data.getBlocks().length&&this.zoomLevels.BLOCK&&(this.zoomLevels.VENUE=this.zoomLevels.BLOCK),this},t.prototype.calculateActiveBlocks=function(t){var e=this;if(void 0===t&&(t=this._self.data.getBlocks()),this.activeBlocks=[],t.map(function(t){var n=e._self.svg.stage.blocks.getBlock(t.id);if(n){var i=n.node.node().getBoundingClientRect(),o=n.node.node().getBBox();if(t.bbox=o,e._self.windowManager.width&&e._self.windowManager.height){var r=e._self.windowManager.width/o.width-e._self.windowManager.width/o.width/3,s=e._self.windowManager.height/o.height-e._self.windowManager.height/o.height/3,a=r<s?r:s;r+=o.x+o.width/2,s+=o.y+o.height/2,a=a>e._self.config.max_zoom?e._self.config.max_zoom:a,t.zoom_bbox={x:r,y:s,k:a};var l=Math.max(0,Math.min(e._self.windowManager.width,i.right)-Math.max(0,i.left))*Math.max(0,Math.min(e._self.windowManager.height,i.bottom)-Math.max(0,i.top)),u=100*l/(e._self.windowManager.width*e._self.windowManager.height);l>0&&e.activeBlocks.push({block:n,ratio:Number(u.toFixed(2))})}}}),this.activeBlocks=this.activeBlocks.sort(function(t,e){return e.ratio-t.ratio}),this.activeBlocks.length){var n=this.activeBlocks[0].block.item;this.zoomLevels.BLOCK=n.zoom_bbox}return this.activeBlocks},t.prototype.zoomToSelection=function(t){void 0===t&&(t=!0);var e=ht(this._self.svg.stage.blocks.node.node()),n=e[0],i=e[1],o=this._self.config.max_zoom;this.zoomLevels.SEAT={x:n,y:i,k:o},t?this._self.svg.node.interrupt().call(this.zoomTypes.animated.translateTo,n,i).call(this.zoomTypes.animated.scaleTo,o):this._self.svg.node.interrupt().call(this.zoomTypes.normal.translateTo,n,i).call(this.zoomTypes.normal.scaleTo,o),this.zoomLevel=St.SEAT,this.dispatchZoomEvent()},t.prototype.zoomToBlock=function(t,e,n){void 0===e&&(e=!0),void 0===n&&(n=!1);var i=this._self.data.getBlocks().find(function(e){return e.id.toString()===t.toString()});i&&(e?n?this._self.svg.node.interrupt().call(this.zoomTypes.fastAnimated.translateTo,i.zoom_bbox.x,i.zoom_bbox.y).call(this.zoomTypes.fastAnimated.scaleTo,i.zoom_bbox.k):this._self.svg.node.interrupt().call(this.zoomTypes.animated.translateTo,i.zoom_bbox.x,i.zoom_bbox.y).call(this.zoomTypes.animated.scaleTo,i.zoom_bbox.k):this._self.svg.node.interrupt().call(this.zoomTypes.normal.translateTo,i.zoom_bbox.x,i.zoom_bbox.y).call(this.zoomTypes.normal.scaleTo,i.zoom_bbox.k),i.zoom_bbox.k===this._self.config.max_zoom?this.zoomLevel=St.SEAT:this.zoomLevel=St.BLOCK,this.dispatchZoomEvent())},t.prototype.zoomToVenue=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),console.info("zoomToVenue");var n=this.zoomLevels.VENUE.x,i=this.zoomLevels.VENUE.y,o=this.zoomLevels.VENUE.k;if(this._self.config.min_zoom=o,this.zoomInit(),1!==this._self.data.getBlocks().length)n&&i&&o&&(t?e?this._self.svg.node.interrupt().call(this.zoomTypes.fastAnimated.translateTo,n,i).call(this.zoomTypes.fastAnimated.scaleTo,o):this._self.svg.node.interrupt().call(this.zoomTypes.animated.translateTo,n,i).call(this.zoomTypes.animated.scaleTo,o):this._self.svg.node.interrupt().call(this.zoomTypes.normal.translateTo,n,i).call(this.zoomTypes.normal.scaleTo,o),this.zoomLevel=St.VENUE,this.dispatchZoomEvent());else{var r=this._self.data.getBlocks()[0];this.zoomToBlock(r.id,t,e)}},t.prototype.zoomEnable=function(){return this._self.svg.node.call(this.zoomTypes.normal),this},t.prototype.zoomDisable=function(){return this._self.svg.node.on(".zoom",null),this},t.prototype.getZoomLevelValues=function(t){return this.zoomLevels[t]},t.prototype.getActiveZoom=function(){return this.zoomLevels[this.zoomLevel]},t.prototype.dispatchZoomEvent=function(){this._self.eventManager.dispatch(Ct.ZOOM_LEVEL_CHANGE,{level:this.zoomLevel,values:this.getZoomLevelValues(this.zoomLevel)})},t}(),Wi={};Object.defineProperty(Wi,"__esModule",{value:!0});var Fi=Wi.isArray=Array.isArray||function(t){return t&&"number"==typeof t.length},$i=function(){function t(t){this._self=t,this.events=[]}return t.prototype.addEventListener=function(t,e){if(Fi(t))for(var n=0;n<t.length;n++)this.events.push({type:t[n],fn:e});else this.events.push({type:t,fn:e});return this},t.prototype.dispatch=function(t,e){return this.events.filter(function(e){return e.type===t}).map(function(t){return t.fn(e)}),this},t}(),Ji=function(){function t(t){var e=this;this.parent=t,this.width=null,this.height=null,this.stage={width:null,height:null},lt(window).on("resize.svg",function(){e.resizeHandler()})}return t.prototype.resizeHandler=function(){var t=lt(this.parent.container_selector).node().getBoundingClientRect();return this.width=t.width,this.height=t.height,this.parent.svg.node.attr("width",t.width),this.parent.svg.node.attr("height",t.height),this.parent.global.eventManager.dispatch(Ct.RESIZE_WINDOW,t),this},t}(),Qi=function(t){function e(){var e=t.call(this)||this;return e.name="pretix",e}return pt(e,t),e.prototype.parse=function(t){t.categories;for(var e=t.zones,n=[],i=0;i<e.length;i++)for(var o=e[i],r=o.position.x,s=o.position.y,a=o.rows,l=0;l<a.length;l++){var u=a[l];r+=u.position.x,s+=u.position.y;for(var c=u.seats,h=function(t){var e=c[t],i=r+e.position.x,o=s+e.position.y,a="".concat(e.category,"-").concat(u.row_number,"-").concat(u.row_number_position),l=n.find(function(t){return t.id===a});if(void 0===l){var h={id:a,title:e.category,color:"#2c2828",seats:[],labels:[]};n.push(h),l=h}var f={id:e.seat_guid,x:i,y:o,title:e.seat_guid,salable:!0,note:"",tags:{category:e.category}};l.seats.push(f)},f=0;f<c.length;f++)h(f)}for(i=0;i<n.length;i++){var d=n[i];d.seats=d.seats.sort(function(t,e){return t.x===e.x?t.y-e.y:t.x-e.x})}return n},e}(function(){function t(){}return t.prototype.parse=function(t){return[]},t}()),to=function(){function t(t,e){var n=this;this.container_selector=t,this.node=null,this.parsers={};var i=this;this.config=new Ue(e),this.eventManager=new $i(this),this.addEventListener=this.eventManager.addEventListener,this.node=lt(t),this.windowManager=new Ji(this),this.zoomManager=new Xi(this),this.data=new ze(this),this.registerConverters(),this.global={eventManager:this.eventManager,windowManager:this.windowManager,config:this.config,data:this.data,zoomManager:this.zoomManager,root:this,svg:this.svg,multi_select:!1,best_available:!1},lt(window).on("keydown.dispatch",function(t,e,n){i.eventManager.dispatch(Ct.KEYDOWN_SVG,$)}),lt(window).on("keyup.dispatch",function(t,e,n){i.eventManager.dispatch(Ct.KEYUP_SVG,$)}),this.dev=new Le(this),this.svg=new Te(this),this.svg.domGenerate(this.node),this.svg.update(),this.windowManager.resizeHandler(),this.zoomManager.init(),this.eventManager.addEventListener(Ct.CLICK_ZOOM_OUT,function(){return n.zoomManager.zoomToVenue()}),this.eventManager.addEventListener(Ct.MULTI_SELECT_ENABLE,function(){n.global.multi_select=!0,n.node.classed("multi-select-enable",!0)}),this.eventManager.addEventListener(Ct.MULTI_SELECT_DISABLE,function(){n.global.multi_select=!1,n.node.classed("multi-select-enable",!1)}),this.eventManager.addEventListener(Ct.BEST_AVAILABLE_ENABLE,function(){n.global.best_available=!0}),this.eventManager.addEventListener(Ct.MBEST_AVAILABLE_DISABLE,function(){n.global.best_available=!1}),this.eventManager.addEventListener(Ct.ZOOM_LEVEL_CHANGE,function(t){t.level===St.VENUE||t.level===St.BLOCK?lt(n.config.zoom_out_button).style("display","none"):t.level===St.SEAT&&lt(n.config.zoom_out_button).style("display","block")}),lt(this.config.zoom_out_button).on("click",function(){n.zoomManager.zoomToVenue(!0)}),this.eventManager.addEventListener(Ct.ADD_BLOCK,function(t){n.svg.stage.blocks.update(),n.windowManager.resizeHandler(),n.zoomManager.calculateZoomLevels(n.data.getBlocks()),n.zoomManager.calculateActiveBlocks(n.data.getBlocks()),n.windowManager.resizeHandler(),n.zoomManager.zoomToVenue(!1)}),this.eventManager.dispatch(Ct.READY,this)}return t.prototype.registerConverters=function(){this.parsers.pretix=new Qi},t}();window.SeatMapCanvas=to}();
//# sourceMappingURL=seatmap.canvas.js.map
